<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 跨层级组件通信 | FE 前端研究所</title>
    <meta name="description" content="ErrorJE 直辖 Blog | FE 前端研究所">
    <link rel="icon" href="/logo.jpg">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.99fee6bc.css" as="style"><link rel="preload" href="/assets/js/app.04bb3a2c.js" as="script"><link rel="preload" href="/assets/js/2.6d170185.js" as="script"><link rel="preload" href="/assets/js/76.b43bb599.js" as="script"><link rel="prefetch" href="/assets/js/10.859902c2.js"><link rel="prefetch" href="/assets/js/100.f31985c5.js"><link rel="prefetch" href="/assets/js/101.e1a418b9.js"><link rel="prefetch" href="/assets/js/102.4b2610e7.js"><link rel="prefetch" href="/assets/js/11.fc953597.js"><link rel="prefetch" href="/assets/js/12.fa692ebb.js"><link rel="prefetch" href="/assets/js/13.27e3f10f.js"><link rel="prefetch" href="/assets/js/14.3182dd59.js"><link rel="prefetch" href="/assets/js/15.6479847e.js"><link rel="prefetch" href="/assets/js/16.da379ab0.js"><link rel="prefetch" href="/assets/js/17.dd0bd8ce.js"><link rel="prefetch" href="/assets/js/18.8ad9b54e.js"><link rel="prefetch" href="/assets/js/19.74238fc3.js"><link rel="prefetch" href="/assets/js/20.60f1a8a8.js"><link rel="prefetch" href="/assets/js/21.c25bfdec.js"><link rel="prefetch" href="/assets/js/22.dbe12b43.js"><link rel="prefetch" href="/assets/js/23.a0cb54ad.js"><link rel="prefetch" href="/assets/js/24.4a414b1d.js"><link rel="prefetch" href="/assets/js/25.93a07ea9.js"><link rel="prefetch" href="/assets/js/26.c9172401.js"><link rel="prefetch" href="/assets/js/27.d8463591.js"><link rel="prefetch" href="/assets/js/28.2ba1e72e.js"><link rel="prefetch" href="/assets/js/29.732b396a.js"><link rel="prefetch" href="/assets/js/3.e21bb9ed.js"><link rel="prefetch" href="/assets/js/30.eb98fda7.js"><link rel="prefetch" href="/assets/js/31.3ace218a.js"><link rel="prefetch" href="/assets/js/32.f9ccb391.js"><link rel="prefetch" href="/assets/js/33.e4d3e853.js"><link rel="prefetch" href="/assets/js/34.c5adedab.js"><link rel="prefetch" href="/assets/js/35.43e31ae5.js"><link rel="prefetch" href="/assets/js/36.d84a5d2e.js"><link rel="prefetch" href="/assets/js/37.7d9a7967.js"><link rel="prefetch" href="/assets/js/38.b8b67fe7.js"><link rel="prefetch" href="/assets/js/39.b6e131dd.js"><link rel="prefetch" href="/assets/js/4.bdffc1b6.js"><link rel="prefetch" href="/assets/js/40.5278289f.js"><link rel="prefetch" href="/assets/js/41.302b5328.js"><link rel="prefetch" href="/assets/js/42.736df250.js"><link rel="prefetch" href="/assets/js/43.dfc18400.js"><link rel="prefetch" href="/assets/js/44.bdf4cd45.js"><link rel="prefetch" href="/assets/js/45.8440854f.js"><link rel="prefetch" href="/assets/js/46.978b71d6.js"><link rel="prefetch" href="/assets/js/47.33aabefb.js"><link rel="prefetch" href="/assets/js/48.6701ef33.js"><link rel="prefetch" href="/assets/js/49.6941dbdb.js"><link rel="prefetch" href="/assets/js/5.8b0953b8.js"><link rel="prefetch" href="/assets/js/50.b36bcf99.js"><link rel="prefetch" href="/assets/js/51.15699984.js"><link rel="prefetch" href="/assets/js/52.c7da722e.js"><link rel="prefetch" href="/assets/js/53.db0735be.js"><link rel="prefetch" href="/assets/js/54.247e3c4e.js"><link rel="prefetch" href="/assets/js/55.d5f46d7d.js"><link rel="prefetch" href="/assets/js/56.f4f16a12.js"><link rel="prefetch" href="/assets/js/57.104894bd.js"><link rel="prefetch" href="/assets/js/58.5d1a37e7.js"><link rel="prefetch" href="/assets/js/59.e170ac5f.js"><link rel="prefetch" href="/assets/js/6.4336baf3.js"><link rel="prefetch" href="/assets/js/60.a2ac5940.js"><link rel="prefetch" href="/assets/js/61.e2eac665.js"><link rel="prefetch" href="/assets/js/62.75c8391d.js"><link rel="prefetch" href="/assets/js/63.cd8b9ee8.js"><link rel="prefetch" href="/assets/js/64.a2e9d850.js"><link rel="prefetch" href="/assets/js/65.d32f90f1.js"><link rel="prefetch" href="/assets/js/66.80a274a1.js"><link rel="prefetch" href="/assets/js/67.7c1e35a0.js"><link rel="prefetch" href="/assets/js/68.db994f15.js"><link rel="prefetch" href="/assets/js/69.f64b7345.js"><link rel="prefetch" href="/assets/js/7.e465b6ba.js"><link rel="prefetch" href="/assets/js/70.449023c5.js"><link rel="prefetch" href="/assets/js/71.0d9de4be.js"><link rel="prefetch" href="/assets/js/72.1d05f05b.js"><link rel="prefetch" href="/assets/js/73.46e686b2.js"><link rel="prefetch" href="/assets/js/74.0fd55c32.js"><link rel="prefetch" href="/assets/js/75.f4dc152e.js"><link rel="prefetch" href="/assets/js/77.b24ddfb7.js"><link rel="prefetch" href="/assets/js/78.3a82b014.js"><link rel="prefetch" href="/assets/js/79.66e8bf47.js"><link rel="prefetch" href="/assets/js/8.df1e4306.js"><link rel="prefetch" href="/assets/js/80.a90c418a.js"><link rel="prefetch" href="/assets/js/81.2386d012.js"><link rel="prefetch" href="/assets/js/82.b6108b1b.js"><link rel="prefetch" href="/assets/js/83.05df04e0.js"><link rel="prefetch" href="/assets/js/84.7e37ba22.js"><link rel="prefetch" href="/assets/js/85.b7b87f39.js"><link rel="prefetch" href="/assets/js/86.26e1d68d.js"><link rel="prefetch" href="/assets/js/87.d7be76f6.js"><link rel="prefetch" href="/assets/js/88.34238cfc.js"><link rel="prefetch" href="/assets/js/89.6a2abc14.js"><link rel="prefetch" href="/assets/js/9.05ace5b0.js"><link rel="prefetch" href="/assets/js/90.60370538.js"><link rel="prefetch" href="/assets/js/91.83bd8f62.js"><link rel="prefetch" href="/assets/js/92.73176f25.js"><link rel="prefetch" href="/assets/js/93.b46d9e51.js"><link rel="prefetch" href="/assets/js/94.29b46bfd.js"><link rel="prefetch" href="/assets/js/95.dc7119dc.js"><link rel="prefetch" href="/assets/js/96.10b68212.js"><link rel="prefetch" href="/assets/js/97.775e29fe.js"><link rel="prefetch" href="/assets/js/98.b389a2b0.js"><link rel="prefetch" href="/assets/js/99.320ef7b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.99fee6bc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">FE 前端研究所</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端初级" class="dropdown-title"><span class="title">前端初级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML / CSS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/html-base/" class="nav-link">HTML 基础</a></li><li class="dropdown-subitem"><a href="/p4/html-pro/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/p4/css-base/" class="nav-link">CSS 基础</a></li><li class="dropdown-subitem"><a href="/p4/css-pro/" class="nav-link">CSS3 / CSS4</a></li></ul></li><li class="dropdown-item"><h4>JS 基础与进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/p4/es-next/01 let 变量和 const 常量.html" class="nav-link">ES-Next</a></li><li class="dropdown-subitem"><a href="/p4/typescript/00 基础知识.html" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/p4/jquery/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/p4/browser/DOM.html" class="nav-link">浏览器原理</a></li></ul></li><li class="dropdown-item"><h4>项目包管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/package/npm/" class="nav-link">NPM</a></li><li class="dropdown-subitem"><a href="/p4/package/yarn/" class="nav-link">YARN</a></li><li class="dropdown-subitem"><a href="/p4/package/learn/" class="nav-link">LEARN</a></li></ul></li><li class="dropdown-item"><h4>团队协作</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/team/code-format/" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/p4/team/tools/" class="nav-link">开发工具链</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端中级" class="dropdown-title"><span class="title">前端中级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>移动端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/web-app/h5/" class="nav-link">H5</a></li><li class="dropdown-subitem"><a href="/p5/web-app/uni-app/" class="nav-link">Uni-App</a></li><li class="dropdown-subitem"><a href="/p5/web-app/react-native/" class="nav-link">React Native</a></li><li class="dropdown-subitem"><a href="/p5/web-app/fullter/" class="nav-link">Fullter</a></li><li class="dropdown-subitem"><a href="/p5/web-app/wechat/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/p5/web-app/weex/" class="nav-link">Weex</a></li><li class="dropdown-subitem"><a href="/p5/web-app/mpvue/" class="nav-link">MpVue</a></li><li class="dropdown-subitem"><a href="/p5/web-app/pwa/" class="nav-link">PWA</a></li><li class="dropdown-subitem"><a href="/p5/web-app/native-app/" class="nav-link">Native App</a></li><li class="dropdown-subitem"><a href="/p5/web-app/hybird-app/" class="nav-link">Hybird App</a></li></ul></li><li class="dropdown-item"><h4>开发框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/vue-base/" class="nav-link router-link-active">Vue</a></li><li class="dropdown-subitem"><a href="/p5/vue-element-admin/" class="nav-link">Vue-Element-Admin</a></li><li class="dropdown-subitem"><a href="/p5/react-base/" class="nav-link">React</a></li></ul></li><li class="dropdown-item"><h4>NodeJS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/node-js/node-base/" class="nav-link">Node 基础</a></li><li class="dropdown-subitem"><a href="/p5/node-js/express.html" class="nav-link">Express</a></li><li class="dropdown-subitem"><a href="/p5/node-js/koa.html" class="nav-link">Koa</a></li></ul></li><li class="dropdown-item"><h4>面试相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/interview/business/" class="nav-link">业务开发</a></li><li class="dropdown-subitem"><a href="/p5/interview/topic/" class="nav-link">面试题</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/live/" class="nav-link">记录</a></li><li class="dropdown-item"><!----> <a href="/blog/economics/" class="nav-link">经济学</a></li><li class="dropdown-item"><!----> <a href="/blog/growth/" class="nav-link">程序员成长</a></li></ul></div></div><div class="nav-item"><a href="/my-resume.html" class="nav-link">Resume</a></div> <a href="https://github.com/ErrorJe/whole-stack-note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端初级" class="dropdown-title"><span class="title">前端初级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML / CSS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/html-base/" class="nav-link">HTML 基础</a></li><li class="dropdown-subitem"><a href="/p4/html-pro/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/p4/css-base/" class="nav-link">CSS 基础</a></li><li class="dropdown-subitem"><a href="/p4/css-pro/" class="nav-link">CSS3 / CSS4</a></li></ul></li><li class="dropdown-item"><h4>JS 基础与进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/p4/es-next/01 let 变量和 const 常量.html" class="nav-link">ES-Next</a></li><li class="dropdown-subitem"><a href="/p4/typescript/00 基础知识.html" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/p4/jquery/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/p4/browser/DOM.html" class="nav-link">浏览器原理</a></li></ul></li><li class="dropdown-item"><h4>项目包管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/package/npm/" class="nav-link">NPM</a></li><li class="dropdown-subitem"><a href="/p4/package/yarn/" class="nav-link">YARN</a></li><li class="dropdown-subitem"><a href="/p4/package/learn/" class="nav-link">LEARN</a></li></ul></li><li class="dropdown-item"><h4>团队协作</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p4/team/code-format/" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/p4/team/tools/" class="nav-link">开发工具链</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端中级" class="dropdown-title"><span class="title">前端中级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>移动端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/web-app/h5/" class="nav-link">H5</a></li><li class="dropdown-subitem"><a href="/p5/web-app/uni-app/" class="nav-link">Uni-App</a></li><li class="dropdown-subitem"><a href="/p5/web-app/react-native/" class="nav-link">React Native</a></li><li class="dropdown-subitem"><a href="/p5/web-app/fullter/" class="nav-link">Fullter</a></li><li class="dropdown-subitem"><a href="/p5/web-app/wechat/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/p5/web-app/weex/" class="nav-link">Weex</a></li><li class="dropdown-subitem"><a href="/p5/web-app/mpvue/" class="nav-link">MpVue</a></li><li class="dropdown-subitem"><a href="/p5/web-app/pwa/" class="nav-link">PWA</a></li><li class="dropdown-subitem"><a href="/p5/web-app/native-app/" class="nav-link">Native App</a></li><li class="dropdown-subitem"><a href="/p5/web-app/hybird-app/" class="nav-link">Hybird App</a></li></ul></li><li class="dropdown-item"><h4>开发框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/vue-base/" class="nav-link router-link-active">Vue</a></li><li class="dropdown-subitem"><a href="/p5/vue-element-admin/" class="nav-link">Vue-Element-Admin</a></li><li class="dropdown-subitem"><a href="/p5/react-base/" class="nav-link">React</a></li></ul></li><li class="dropdown-item"><h4>NodeJS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/node-js/node-base/" class="nav-link">Node 基础</a></li><li class="dropdown-subitem"><a href="/p5/node-js/express.html" class="nav-link">Express</a></li><li class="dropdown-subitem"><a href="/p5/node-js/koa.html" class="nav-link">Koa</a></li></ul></li><li class="dropdown-item"><h4>面试相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/p5/interview/business/" class="nav-link">业务开发</a></li><li class="dropdown-subitem"><a href="/p5/interview/topic/" class="nav-link">面试题</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/live/" class="nav-link">记录</a></li><li class="dropdown-item"><!----> <a href="/blog/economics/" class="nav-link">经济学</a></li><li class="dropdown-item"><!----> <a href="/blog/growth/" class="nav-link">程序员成长</a></li></ul></div></div><div class="nav-item"><a href="/my-resume.html" class="nav-link">Resume</a></div> <a href="https://github.com/ErrorJe/whole-stack-note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/p5/vue-base/" class="sidebar-link">Vue</a></li><li><a href="/p5/vue-base/01 Vue 基础.html" class="sidebar-link">Vue 基础（版本、生命周期与环境）</a></li><li><a href="/p5/vue-base/02 Vue 项目启动和基本配置.html" class="sidebar-link">Vue 项目启动和基本配置</a></li><li><a href="/p5/vue-base/03 Vue 核心语法.html" class="sidebar-link">Vue 核心语法</a></li><li><a href="/p5/vue-base/04 Vue 进阶语法.html" class="sidebar-link">Vue 进阶语法</a></li><li><a href="/p5/vue-base/05 Vue 组件基础.html" class="sidebar-link">Vue 组件基础</a></li><li><a href="/p5/vue-base/06 Vue 父子组件通信.html" class="sidebar-link">Vue 父子组件通信</a></li><li><a href="/p5/vue-base/07 Vue 跨层级组件通信.html" class="active sidebar-link">Vue 跨层级组件通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#provide-和-injects-后辈组件继承遗产" class="sidebar-link">provide 和 injects 后辈组件继承遗产</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#provide-生产" class="sidebar-link">provide 生产</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#injects-注入" class="sidebar-link">injects 注入</a></li></ul></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#孙向前辈通信（向上通知-dispatch-parent）" class="sidebar-link">孙向前辈通信（向上通知 $dispatch | $parent）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#孙向子组件通信-parent" class="sidebar-link">孙向子组件通信 $parent</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#孙向父组件通信-dispatch" class="sidebar-link">孙向父组件通信 $dispatch</a></li></ul></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#祖向后辈通信（向下传递-broadcast-children）" class="sidebar-link">祖向后辈通信（向下传递 $broadcast | $children）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#实现广播方法-broadcast" class="sidebar-link">实现广播方法 $broadcast</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#使用方式" class="sidebar-link">使用方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#向下传属性集合-attrs" class="sidebar-link">向下传属性集合 $attrs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#基本-api（inheritattrs）" class="sidebar-link">基本 API（inheritAttrs）</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#子组件-v-bind-继续传属性集合" class="sidebar-link">子组件 v-bind 继续传属性集合</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#孙子组件" class="sidebar-link">孙子组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#向下传方法集合-listeners" class="sidebar-link">向下传方法集合 $listeners</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#父组件传方法" class="sidebar-link">父组件传方法</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#子组件-v-on-继续传方法集合" class="sidebar-link">子组件 v-on 继续传方法集合</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#孙子组件-2" class="sidebar-link">孙子组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#ref-拿到组件实例" class="sidebar-link">ref 拿到组件实例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#父组件拿到子组件实例" class="sidebar-link">父组件拿到子组件实例</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#子组件" class="sidebar-link">子组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#总线通信-bus" class="sidebar-link">总线通信 $bus</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#根组件-main-js" class="sidebar-link">根组件 main.js</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#兄弟组件" class="sidebar-link">兄弟组件</a></li><li class="sidebar-sub-header"><a href="/p5/vue-base/07 Vue 跨层级组件通信.html#由子组件派发（用到-nexttick）" class="sidebar-link">由子组件派发（用到 $nextTick）</a></li></ul></li></ul></li><li><a href="/p5/vue-base/08 Vue 函数式组件和 JSX 应用.html" class="sidebar-link">Vue 函数式组件和 JSX 应用</a></li><li><a href="/p5/vue-base/09 Vue 过渡和动画.html" class="sidebar-link">Vue 过渡和动画</a></li><li><a href="/p5/vue-base/10 Vue-Cli 脚手架.html" class="sidebar-link">vue-cli 脚手架</a></li><li><a href="/p5/vue-base/11 Vue-Router 路由器.html" class="sidebar-link">Vue-Router 路由器</a></li><li><a href="/p5/vue-base/12 Vuex 状态管理器.html" class="sidebar-link">Vuex 状态管理器</a></li><li><a href="/p5/vue-base/13 Vant 项目.html" class="sidebar-link">Vant 项目</a></li><li><a href="/p5/vue-base/14 v-tooltip 中文文档翻译.html" class="sidebar-link">v-tooltip 中文文档翻译</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-跨层级组件通信"><a href="#vue-跨层级组件通信" class="header-anchor">#</a> Vue 跨层级组件通信</h1> <p>介绍几种跨层级组件的通信方式，比如兄弟组件，爷爷孙子等关系组件</p> <h2 id="provide-和-injects-后辈组件继承遗产"><a href="#provide-和-injects-后辈组件继承遗产" class="header-anchor">#</a> provide 和 injects 后辈组件继承遗产</h2> <p>就是为了让后辈组件能够拿到前辈组件的数据，反过来让后辈给祖先组件传值就不行。</p> <p>注意，一般用于组件开发，尽量不要用于日常开发。</p> <ul><li>单向数据流混乱</li> <li>实现工具库，可以使用这个方式</li></ul> <h3 id="provide-生产"><a href="#provide-生产" class="header-anchor">#</a> provide 生产</h3> <blockquote><p>由先辈组件创建内容
也可以传 this 这样的引用对象</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 作为祖先，给后人留下的数据遗产。可以跨代传递。跟 data 钩子的用法一致。</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      someValue<span class="token operator">:</span> <span class="token string">'来自祖先的神秘遗产'</span>，
      parent<span class="token operator">:</span><span class="token keyword">this</span> <span class="token comment">// 把自己实例给传下去（使用最多的场景）</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// 对象形式也可以</span>
  provide<span class="token operator">:</span><span class="token punctuation">{</span>
  	someValue<span class="token operator">:</span> <span class="token string">'来自祖先的神秘遗产'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="injects-注入"><a href="#injects-注入" class="header-anchor">#</a> injects 注入</h3> <blockquote><p>后辈组件去消费内容。相当于是 consumer</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 继承祖先遗产。用法和 props 一致。可以直接使用 {{someValue}}</span>
  <span class="token comment">// 所以不要与 data 重名</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'someValue'</span> <span class="token string">'parent'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="孙向前辈通信（向上通知-dispatch-parent）"><a href="#孙向前辈通信（向上通知-dispatch-parent）" class="header-anchor">#</a> 孙向前辈通信（向上通知 $dispatch | $parent）</h2> <blockquote><p>首先这个 dispatch 是自己实现在 main.js 且挂载到 <code>Vue.prototype</code> 上的</p></blockquote> <h3 id="孙向子组件通信-parent"><a href="#孙向子组件通信-parent" class="header-anchor">#</a> 孙向子组件通信 $parent</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 孙组件通过这个 API 先拿到子组件实例</span>
<span class="token comment">// 然后让子组件去派发 input 事件</span>
<span class="token comment">// 这样就仅仅是两层事件的派发，若是多层，要看下面的做法去实现 dispatch</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="孙向父组件通信-dispatch"><a href="#孙向父组件通信-dispatch" class="header-anchor">#</a> 孙向父组件通信 $dispatch</h3> <blockquote><p>孙在已经通知了子组件的情况下，子组件还要单独去实现向父组件派发孙给的事件的吗？</p></blockquote> <h4 id="实现-vue-prototype-dispatch"><a href="#实现-vue-prototype-dispatch" class="header-anchor">#</a> 实现 Vue.prototype.$dispatch</h4> <blockquote><p>让孙组件的事件可以发到父组件， 而$dispatch方法也是由孙子组件（或者更深）派发的事件，让所有先辈监听和触发到该事件。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
Vue<span class="token punctuation">.</span>protytype<span class="token punctuation">.</span><span class="token function-variable function">$dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1 获取父组件实例</span>
  <span class="token comment">// this 就是调用该方法的实例。也就是孙组件。然后拿到了子组件</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent
  <span class="token comment">// 2 向上派发</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 派发给先辈组件</span>
    parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token comment">// 如果爸爸还有爸爸的话，就继续循环派发，直到所有先辈都拿到了该事件</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>优化版本：当前是所有前辈都会触发，现在想要指定某个前辈组件触发，要改动代码</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>protytype<span class="token punctuation">.</span><span class="token function-variable function">$dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> componentNames<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent
  
  <span class="token keyword">while</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 触发指定组件的方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">===</span> componentNames<span class="token punctuation">)</span><span class="token punctuation">{</span>
      parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="孙组件派发事件"><a href="#孙组件派发事件" class="header-anchor">#</a> 孙组件派发事件</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 简单版本</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$dispatch</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>

<span class="token comment">// 指定组件版本使用，指定组件名为 parent1 的触发 input 方法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$dispatch</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'parent1'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="祖向后辈通信（向下传递-broadcast-children）"><a href="#祖向后辈通信（向下传递-broadcast-children）" class="header-anchor">#</a> 祖向后辈通信（向下传递 $broadcast | $children）</h2> <blockquote><p>也是广播的方式。这里要递归实现了，因为每个子组件可能有自己的很多个子组件</p></blockquote> <ul><li>与 <code>$parent</code> 一样也有一个 <code>$children</code> 事件，用于调用儿子组件的方法或属性</li></ul> <h3 id="实现广播方法-broadcast"><a href="#实现广播方法-broadcast" class="header-anchor">#</a> 实现广播方法 $broadcast</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
Vue<span class="token punctuation">.</span>prorotype<span class="token punctuation">.</span><span class="token function-variable function">$broadcast</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$children
  <span class="token comment">// 通知事件</span>
  <span class="token keyword">const</span> <span class="token function-variable function">broadcast</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历每个孩子</span>
    children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token comment">// 递归获取孩子和通知事件</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">broadcast</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">broadcast</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>优化版本：指定多个儿子</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>prorotype<span class="token punctuation">.</span><span class="token function-variable function">$broadcast</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> compNames<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$children <span class="token comment">// 是个数组</span>
  <span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  i<span class="token operator">&lt;</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>compNames<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> compNames<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">broadcast</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">broadcast</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用方式</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$broadcast</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'son'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h3> <h4 id="后辈组件监听某事件"><a href="#后辈组件监听某事件" class="header-anchor">#</a> 后辈组件监听某事件</h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@error</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="先辈组件统一通知"><a href="#先辈组件统一通知" class="header-anchor">#</a> 先辈组件统一通知</h4> <blockquote><p>让所有正在监听这个 error 事件的后辈组件都能被触发执行</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 比如去根组件触发  App.vue</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$broadcast</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="向下传属性集合-attrs"><a href="#向下传属性集合-attrs" class="header-anchor">#</a> 向下传属性集合 $attrs</h2> <h3 id="基本-api（inheritattrs）"><a href="#基本-api（inheritattrs）" class="header-anchor">#</a> 基本 API（inheritAttrs）</h3> <blockquote><p>基于 $attrs 用法的说明，实现子组件将父组件轮空的传值</p></blockquote> <p>有这样一种情况，父组件传了2个绑定值，照理说，子组件需要提供2个对应的props坑位去接收。</p> <p>但实际情况是子组件可能只显式接收了一个 props ，那么没有被接收的那个父组件值，会变成子组件根元素的属性节点。</p> <ul><li>父组件传2个值</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>demo</span> <span class="token attr-name">:first</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>firstMsg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:second</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>secondMessage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>demo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>子组件接受1个值</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'first'</span><span class="token punctuation">]</span>
</code></pre></div><p>没有被接收的变为子组件根节点的属性</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">second</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>secondMessage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>在子组件中可以通过 <code>this.$attrs</code>拿到这个没有被显式接受的 props</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有被绑定的属性&gt;&gt;&gt;'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {second：&quot;secondMessage&quot;}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>子组件中使用 inheritAttrs：false</li></ul> <blockquote><p>也就是当我们使用 <code>this.$attrs</code>时，为了确保不会默认变成根元素的属性节点，需要设置  <code>inheritAttrs：false</code>
这个也是我们封装深层组件的基础。如父组件传了3个变量， 子组件只用到1个，剩余2个通过 $attrs 传给孙子组件。</p></blockquote> <p>这就是取消属性的继承，这样上面没有被接收的 props 就不会出现在根元素节点的属性上</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 也是 vue 实例的一个选项</span>
  inheritAttrs<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="子组件-v-bind-继续传属性集合"><a href="#子组件-v-bind-继续传属性集合" class="header-anchor">#</a> 子组件 v-bind 继续传属性集合</h3> <p>通过子组件的<code>this.$attrs</code>传给孙子组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>next-demo</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>next-demo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="孙子组件"><a href="#孙子组件" class="header-anchor">#</a> 孙子组件</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>props <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'second'</span> <span class="token punctuation">,</span> <span class="token string">'third'</span><span class="token punctuation">]</span>
</code></pre></div><p>若孙子组件下面还有更深的组件，还是要做两件事</p> <ul><li>使用 <code>$attrs</code>统一传递轮空的上层值</li> <li>配合 <code>inheritAttrs：false</code>实例配置</li></ul> <h2 id="向下传方法集合-listeners"><a href="#向下传方法集合-listeners" class="header-anchor">#</a> 向下传方法集合 $listeners</h2> <blockquote><p><code>$attrs</code> 是向下传递数据，<code>$listeners</code> 是向下传递方法。前者收集轮空的props，后者收集父组件给的所有事件。
通过手动去调用 <code>$listeners</code> 对象里的方法，原理就是 <code>$emit</code> 监听事件，
<code>$listeners</code> 也可以看成一个包裹监听事件的一个对象。</p></blockquote> <h3 id="父组件传方法"><a href="#父组件传方法" class="header-anchor">#</a> 父组件传方法</h3> <p>子组件模板上面进行 changeData 和 another 两个事件监听</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>demo</span> <span class="token attr-name"><span class="token namespace">v-on:</span>changeData</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>changeData<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>another</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>another<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>demo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="子组件-v-on-继续传方法集合"><a href="#子组件-v-on-继续传方法集合" class="header-anchor">#</a> 子组件 v-on 继续传方法集合</h3> <p>就用到了一个 <code>another</code> 事件，另一个事件通过 <code>$listeners收集并通过</code>v-on`继续传递给孙子组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$emit('another')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>子组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>next-demo</span>  <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>$listeners<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>next-demo</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 孙子组件 --&gt;</span>
</code></pre></div><h3 id="孙子组件-2"><a href="#孙子组件-2" class="header-anchor">#</a> 孙子组件</h3> <p>从<code>$listeners</code>拿到其中的某个事件，直接调用执行（相当于 emit 触发事件了，不过是跨多层向上派发了事件触发通知）</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>$listeners.changeData(&quot;change&quot;)<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>孙子组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="ref-拿到组件实例"><a href="#ref-拿到组件实例" class="header-anchor">#</a> ref 拿到组件实例</h2> <ul><li>用在元素上就是获取 DOM</li> <li>用在组件上就是获取组件实例</li> <li>用 <code>v-for</code> 出来的 DOM 是一个数组，普通渲染出来的 DOM 就是单个的属性</li></ul> <h3 id="父组件拿到子组件实例"><a href="#父组件拿到子组件实例" class="header-anchor">#</a> 父组件拿到子组件实例</h3> <blockquote><p>对应于上面的 provide 和 inject， 让父组件可以拿到子组件数据和调用子组件方法</p></blockquote> <p>父组件通过 <code>ref</code> 属性去拿到子组件实例，然后就可以拿到子组件里面的方法。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">&gt;</span></span>

<span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 拿到子组件方法。但是这样耦合性比较高</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="子组件"><a href="#子组件" class="header-anchor">#</a> 子组件</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>methods<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 定义了子组件方法</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总线通信-bus"><a href="#总线通信-bus" class="header-anchor">#</a> 总线通信 $bus</h2> <blockquote><p>专门弄一个 vue 实例用于通信，如同级组件之间。
缺陷就是必须定义到全局上了。容易触发同名的全部事件（当多人开发时）</p></blockquote> <ul><li>任意组件之间的通信。因是自由度较大，所以只适合小规模的更新（不好维护），大规模还是要用到 <code>Vuex</code></li> <li>监听父组件的 <code>mounted</code> 事件：组件挂载的顺序是 -&gt; 父组件 -&gt; 渲染子组件 -&gt; 子组件 mounted -&gt; 父 mounted</li></ul> <h3 id="根组件-main-js"><a href="#根组件-main-js" class="header-anchor">#</a> 根组件 main.js</h3> <p>这种方式也可以用来扩展 vue。相当于是公开的发布订阅</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 修改 vue 的原型</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="兄弟组件"><a href="#兄弟组件" class="header-anchor">#</a> 兄弟组件</h3> <ul><li>触发事件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 派发事件, 并传入数据</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span> good<span class="token punctuation">)</span>
</code></pre></div><ul><li>绑定事件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1 一般我们会选择 mounted 中去挂载</span>
<span class="token comment">// 且一个事件可以触发多个函数，按定义顺序执行</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn1<span class="token punctuation">)</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn2<span class="token punctuation">)</span>  
<span class="token punctuation">}</span>

<span class="token comment">// 2 利用方法</span>
methods<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3 适时消除监听</span>
<span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="由子组件派发（用到-nexttick）"><a href="#由子组件派发（用到-nexttick）" class="header-anchor">#</a> 由子组件派发（用到 $nextTick）</h3> <blockquote><p>先要知道组件的挂载顺序，先挂子后挂父。若在父组件中绑定事件，却在子组件的<code>mounted</code>中emit的事件其实不会被触发
所以要让 $nextTick 去延迟执行，等待 DOM 渲染完毕</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mounted<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token comment">// 是个队列，把任务放到后面去执行（页面渲染完毕之后）</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ErrorJe/whole-stack-note/edit/gh-pages/p5/vue-base/07 Vue 跨层级组件通信.md" target="_blank" rel="noopener noreferrer">编辑文档</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/23/2020, 4:53:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/p5/vue-base/06 Vue 父子组件通信.html" class="prev">Vue 父子组件通信</a></span> <span class="next"><a href="/p5/vue-base/08 Vue 函数式组件和 JSX 应用.html">Vue 函数式组件和 JSX 应用</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.04bb3a2c.js" defer></script><script src="/assets/js/2.6d170185.js" defer></script><script src="/assets/js/76.b43bb599.js" defer></script>
  </body>
</html>
