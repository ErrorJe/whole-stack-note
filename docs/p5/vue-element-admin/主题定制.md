# 主题定制


> 每个 UI 库基本都是提供了更改主题样式的方式。但是大多都是通过 Less 进行 CSS 的预编译的。


比如 `antd`就是在 `vue.config.js`中的 css - loaderOptions 选项中去配置 less 里的 modifyVars 这个东西。去更改它的 `less` 样式变量值。

## Antd-Vue 的主题定制

### Antd-Vue 的样式变量库

[https://github.com/vueComponent/ant-design-vue/blob/master/components/style/themes/default.less](https://github.com/vueComponent/ant-design-vue/blob/master/components/style/themes/default.less)

这是个 Github 地址，放了所有 antd-vue 的 less 变量。



### 在 vue-cli3 中的配置方式

```javascript
// vue.config.js
module.exports = {
  css: {
    loaderOptions: {
      less: {
        modifyVars: {
          'primary-color': '#1DA57A',
          'link-color': '#1DA57A',
          'border-radius-base': '2px',
        },
        javascriptEnabled: true
      }
    }
  }
}
```



### antd 主题的动态编译

使用场景是我们可以在程序中拿到 Less 变量，然后进行动态修改编译。

这里的一个问题是会造成性能卡顿，一般我们会在本地编译好几个静态的主题，然后提供给用户切换。



#### 需要用到 antd-theme-webpack-plugin 插件

> 这是社区提供的一个 webpack 插件，基于 vue-cli3 也是用 webpack 插件的配置形式
> [https://github.com/mzohaibqc/antd-theme-webpack-plugin](https://github.com/mzohaibqc/antd-theme-webpack-plugin)
> 安装 `npm i -D antd-theme-webpack-plugin`


```javascript
// vue.config.js 中去配置插件
const path = require('path') // 1 还需要引入 path
const AntDesignThemePlugin = require('antd-theme-webpack-plugin');

const options = {
  antDir: path.join(__dirname, './node_modules/antd-design-vue'), // 2 依赖路径
  stylesDir: path.join(__dirname, './src'),
  // 3 存放组件库所有 less 变量的位置
  varFile: path.join(__dirname, './node_modules/antd-design-vue/lib/style/themes/default.less'),
  mainLessFile: "",
  themeVariables: ['@primary-color'], // 4 需要更改的变量
  generateOnce: false,
  // 这个 lessUrl 看情况要不要加，如果在 public/index.html 已经引入了，则不需要增加
  lessUrl: "https://cdnjs.cloudflare.com/ajax/libs/less.js/2.7.2/less.min.js",
  publicPath: ""
}

const themePlugin = new AntDesignThemePlugin(options);

// 5 配置 webpack 插件
module.exports = {
  configureWebpack:{
    plugins:[themePlugin]
  }
}
```



#### 更改 public/index.html 的 JS

让 Less 变量管理对象直接挂载到 window 中

```javascript
<link rel="stylesheet/less" type="text/css" href="/color.less" />
<script>
  window.less = {
    async: false,
    env: 'production',
 		javascriptEnabled: true, // 开启 js
  	modifyVars:{ // 默认的主题配色
      "primary-color":"#1DA57A"
    }
  };
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/less.js/2.7.2/less.min.js"></script>
```



#### 抽离组件中的样式

相应的新建一个该组件的less文件， 同名如 `index.less`，引入UI库的less变量文件，然后就可以直接使用 less 变量了（可以参照上面 webpack 插件配置时的 less 路径）

```css
@import "~antd-design-vue/lib/style/themes/default.less"
.setting-xxx-handle {
	background:@primary-color;
}
```

组件内的 style 标签需要引入这个 less 文件

```vue
<template>
	<div class="setting-xxx-handle"></div>
</template>
<style lang="less" src="./index.less"></style>
```

重启服务，然后就可以去 window 对象中操作 Less 变量。然后就会动态编译，直接生效

```
window.less.modifyVars({"@primary-color":"red"})
```



## vant 的主题定制



### vant 的样式变量库

[https://github.com/youzan/vant/blob/dev/src/style/var.less](https://github.com/youzan/vant/blob/dev/src/style/var.less)

跟上面一样，需要修改的 less 变量从这里面去找



### 按需加载样式

> babel 版本在 7 以上，在 babel.config.js 中去配置


vant 还支持还需加载样式，动态匹配样式的 `name` 值

```javascript
// babel.config.js
module.exports = {
  plugins: [
    [
      'import',
      {
        libraryName: 'vant',
        libraryDirectory: 'es',
        style: name => `${name}/style/less` // 指定样式路径
      },
      'vant'
    ]
  ]
};
```



### 修改相应的样式变量

使用 less 提供的`modifyVars`就可以对变量进行修改

```javascript
// vue.config.js
module.exports = {
  css: {
    loaderOptions: {
      less: {
        modifyVars: {
          red: '#03a9f4',
          blue: '#3eaf7c',
          orange: '#f08d49',
          'text-color': '#111',
          'button-primary-border-color':'red'
        },
        javascriptEnabled: true
      }
    }
  }
}
```

运行后出现报错的原因，可能是项目中还没有安装 Less 和 less-loader

`npm i --save-dev less less-loader`

然后重新运行就好了



## 更改指定元素的样式

经过各种 UI 库的封装，如一个文本控件，可能嵌套了很多层。无法直接通过 CSS 选择器直接选中。



### 深度选择器 >>>

这个时候就需要用到深度选择器`>>>`去得到某控件下的内部元素。



### 找到某元素

通过 chrome 去选中目标元素，然后去样式面板看产生响应效果的 CSS 选择器。

然后找到包含该目标元素的外部控件，id 和 class 都可以，然后用 >>> 去指定刚才目标元素的 class

```css
// 大概是这样的形式
.father-style >>> .son-style {}
```



## 主题换肤前后端实现区别



### 后端实现思路

- 前端选择主题后，有些变量会传给后端
- 后端用 less 或 sass 变量，build 一个新的 css 文件返回给前端
- 前端新建 style 标签，加载 css 达到换肤的效果



### 前端实现思路

- 前端不能选，只能给定几个主题。如白，黑等，主题的 CSS 是build 好的
- 通过 html 上的 class 来切换主题
