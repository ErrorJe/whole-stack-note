# 第三方库使用

## 通用处理
### 安装依赖方式
`npm i xxxx --save` 生产环境， 简写`npm i xxxx -S`

`npm i xxxx --save-dev`开发环境，简写`-D`



### 局部注册组件

```vue
<template>
	<xxx></xxx>
</template>

<script>
  import xxx from 'xxx'
	export default {
		components:{xxx}
  }
</script>
```



### 全局注册

```javascript
import countTo from 'vue-count-to'
Vue.component('countTo', countTo)
// Vue.use(countTo) 这种写法对引入的东西有要求，里面得有一个 Install 方法.一般UI库都是支持的
```



### 原型挂载

使用的时候在实例上就可以拿到，比较适合一些常用库。如

- lodash, _
- moment, $moment
- axios, $axios
- async, $async

```javascript
// 1 挂载原型
import moment from 'moment'
Object.defineProperty(Vue.prototype, '$moment', { value: moment })

// 2 在某个组件实例中使用 this.$moment().fn()
console.log('The time is '.this.$moment().format('HH:mm'))
```



## Echarts 使用

> 是百度开发的图表库，也是目前主流应用
>
> EChars就是通过Canvas来完成的



### 安装

有很多种方式来使用ECharts库

- 官网下载源代码版本
- GIT上拉一下release版本，解压出来的dist文件夹中
- npm获取`npm i echarts --S`
- CND，如cdnjs, npmcdn或者是bootcdn上都有最新的版本



### 引入方式

#### script标签直接引入

```html
<script src="echarts.min.js"></script>
```



#### webpack方式引入

> 安装好的包都是在 `node_modules`目录下， 用require引入包名就行。
> 而若用import引入，则是写全路径也就是相对路径。
> 可以按需引入的组件目录，[https://github.com/apache/incubator-echarts/blob/master/index.js](https://github.com/apache/incubator-echarts/blob/master/index.js)


```javascript
const echarts = require('echarts') // 这种方式是全部引入

// 按需引入
var echarts = require('echarts/lib/echarts');// 引入 ECharts 主模块
// 引入柱状图
require('echarts/lib/chart/bar');
// 引入提示框和标题组件
require('echarts/lib/component/tooltip');
require('echarts/lib/component/title');
```

如果是Vue项目，则可以直接挂载到vue实例上

```javascript
// /src/main.js中引入echarts
import echarts from 'echarts'
Vue.prototype.$echarts = echarts
```



### Vue 中使用方式

#### 创建 charts.vue 组件

先直接从官方示例中引入代码，然后在 vue 中是没有操作 DOM 这样的行为的，所以暂时先写，后面整改。

```javascript
// src/components/Charts.vue 用于封装 Echarts 组件
import echarts from 'echarts' // 1 引入

// 2 在 mounted 生命周期中使用。代码示例直接去官网复制
export default {
  mounted() {
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));

    // 指定图表的配置项和数据
    var option = {
      title: {
        text: 'ECharts 入门示例'
      },
      tooltip: {},
      legend: {
        data:['销量']
      },
      xAxis: {
        data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
      },
      yAxis: {},
      series: [{
        name: '销量',
        type: 'bar',
        data: [5, 20, 36, 10, 10, 20]
      }]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
  }
}
```



#### 按照 vue 的方式挂载 echarts

在 vue 中，使用 `ref` 去指定 DOM 名字

```vue
<template>
	<div ref="chartDom"></div>
</template>

<script>
import echarts from 'echarts'

export default {
  mounted() {
    // 1 基于准 vue 获取 DOM 的方式
    var myChart = echarts.init(this.$refs.chartDom);

    // 2 指定图表的配置项和数据
    var option = {
      title: {
        text: 'ECharts 入门示例'
      },
      tooltip: {},
      legend: {
        data:['销量']
      },
      xAxis: {
        data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
      },
      yAxis: {},
      series: [{
        name: '销量',
        type: 'bar',
        data: [5, 20, 36, 10, 10, 20]
      }]
    };

    // 3 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
  }
}
</script>
```

还需要一个处理 echarts 在 vue 中的异步加载处理库

`npm i -D resize-detector`安装。

```javascript
import echarts from 'echarts'
import {addListener, romoveListener} from 'resize-detector' // 1 引入
import debounce from 'lodash/debounce' // 6 引入帮助方法——防抖

export default {
  mounted() {
    this.chart = echarts.init(this.$refs.chartDom);
    addListener(this.$refs.chartDom, this.resize) // 2 添加事件监听

    this.chart.setOption = {
      title: {
        text: 'ECharts 入门示例'
      },
      tooltip: {},
      legend: {
        data:['销量']
      },
      xAxis: {
        data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
      },
      yAxis: {},
      series: [{
        name: '销量',
        type: 'bar',
        data: [5, 20, 36, 10, 10, 20]
      }]
    };
  },
  methods:{
    // 3 事件，在做防抖之前，每次渲染会触发好几次该方法
    resize(){
      this.chart.resize()
    }
  },
  // 4 组件销毁之前，移除事件监听
  beforeDestroy() {
    removeListener(this.$refs.chartDom, this.resize)
    // 5 同时销毁 charts 实例，防止内存泄漏
    this.chart.dispose()
    this.chart = null
  },
  // 7 执行方法，处理防抖
  created(){
    this.resize = debounce(this.resize, 300)
  }
}
```



#### 封装该 chart 组件

> 使其配置可以由外部传入，这里对上面进行调整


```javascript
import echarts from 'echarts'
import {addListener, romoveListener} from 'resize-detector' 
import debounce from 'lodash/debounce'

export default {
  // 1 配置由父组件传入
  props:{
    option:{
      type:Object,
      default:() => {}
    }
  },
  mounted() {
    // 4 渲染图标
    this.renderChart()
    addListener(this.$refs.chartDom, this.resize) 
  },
  methods:{
    resize(){
      this.chart.resize()
    },
    // 2 基于准备好的 dom，初始化 charts 实例
    renderChart(){
      this.chart = echarts.init(this.$refs.chartDom)
    	// 3 传入配置
      this.chart.setOption(this.options)
    }
  },
  beforeDestroy() {
    removeListener(this.$refs.chartDom, this.resize)
    this.chart.dispose()
    this.chart = null
  },
  created(){
    this.resize = debounce(this.resize, 300)
  },
  // 5 监听 options,由于配置是复杂对象，所以要开启深度选项
  // 深度监听对性能消耗是比较大的
  watch:{
    option:{
      handler(val){
        this.chart.setOption(val)
      },
      deep:true
    }
    /* 浅层监听方法，配合父组件的手动去更改配置
    		option(val){
    			this.chart.setOption(val)
    		}
    */
  }
}
```



#### 使用该图表组件

在其他组件中调用该组件

```vue
<tempalte>
  <div>
    <Chart :option="chartOptions" style="height:400px;" />
  </div>
</tempalte>
<script>
  import Chart from '../../components/Chart'
  import random from 'lodash/random'
  // 引入后去注册
  export default {
    components:{
      Chart
    },
    mounted(){
      this.interval = setInterval(()=>{
        // 每3秒生成 100 以内的随机数， 去改变配置
        this.chartOption.series[0].data = this.chartOption.series[0].data.map(()=>random(100))
      }, 3000)
      // 手动更改配置的写法，配合上面浅层监听。解决深层监听带来的性能问题
      // this.chartOption = {...this.chartOption}
    },
    // 组件关闭要销毁定时器
    beforeDestroy(){
      clearInterval(this.interval)
    },
    data(){
      return {
        chartOptions: {
          title: {
            text: 'ECharts 入门示例'
          },
          tooltip: {},
          legend: {
            data:['销量']
          },
          xAxis: {
            data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
          },
          yAxis: {},
          series: [{
            name: '销量',
            type: 'bar',
            data: [5, 20, 36, 10, 10, 20]
          }]
        }
      }
    }
  }
</script>
```



### 各类图形使用方式

#### 饼图

在上面基本页面结构的基础上，只需要修改配置项就可以绘制别的图形。

```javascript
let options = {
  title:{
    text:'饼图',
    subtext:'2017年度(单位：万)'
  },
  series: [
    // 多个饼图，如果不配置位置和半径大小，位置会完全重叠
    {
      name:'性别比列',
      type:'pie', // 饼图
      radius:'20%', // 半径
      center:['30%', '50%'], // 相对于容器的位置
      data:[
        {name:'男', value:2750},
        {name:'女', value:2568}
      ]
    },
    {
      name:'年龄比例',
      type:'pie',
      radius:'60%',
      center:['70%', '50%'], 
      data:[
        {name:'18以下', value:1253},
        {name:'18-28岁', value:2365},
        {name:'28以上', value:5236}
      ]
    },
    {
      name:'同心饼图',
      type:'pie',
      radius:['70%', '30%'], // 内半径，外半径
      center:['70%', '50%'], 
      data:[
        {name:'18以下', value:1253},
        {name:'18-28岁', value:2365},
        {name:'28以上', value:5236}
      ]
    },
  ]
}
```



#### 雷达图

```javascript
let options = {
  title:{
    text:'人物属性'
  },
  legend: {
    data:['张三', '李四'],
    right:0,
    top:'50%',
    orient:'vertical'
  },
  radar:{ // 雷达的属性，就是每个角的属性标记
    indicator:[
      {name:'HP', max:999},
      {name:'攻击力', max:888},
      {name:'防御力', max:888},
      {name:'幸运值', max:888}
    ]
  },
  series:[
    {
      name:'属性',
      type:'radar',
      data:{
        {name:'张三', value:[380, 56, 3, 120]},
    		{name:'李四', value:[380, 256, 3, 0]},
      }
    }
  ]
}
```



### JS控制ECharts

#### 丰富容器结构

```html
<style>
  .box {
    border: 1px solid black;
    width:1000px;
    height:600px;
  }
  .box .left, .box .right {
    width:50%;
    height:100%;
    float:left;
  }
</style>

<div class="box">
  <div class="left"></div>
  <div class="right"></div>
</div>
```



#### 初始化ECharts和动态生成图表

```javascript
const $ = document.querySelectorAll.bind(document)

window.onload = function() {
  let oLeft = $('.left')[0]
  let oRight = $('.right')[0]
  
  // 模拟数据
  let datas = [ 
    {
      name:'湖南',
      value:1675,
      citys: [
        {name:'长沙', value:816},
        {name:'潭州', value:435},
        {name:'桃园', value:424}
      ]
    },
    {
      name:'山东',
      value:1354,
      citys: [
        {name:'济南', value:615},
        {name:'临沂', value:443},
        {name:'德州', value:296}
      ]
    },
    {
      name:'东北',
      value:374,
      citys: [
        {name:'黑龙江', value:112},
        {name:'牡丹江', value:65}，
        {name:'漠河', value:197}
      ]
    }
  ]
  
  // 左边，显示省份
  let option = {
    title:{
      text:'省份数据'
    },
    series:[
      {
        name:'省数据',
        type:'pie',
        radius:'50%',
        data:datas.map(json=>({name:json.name, value:json.value}))
      }
    ]
  }
  
  // 初始化图表
  let chart = echarts.init(oLeft)
  chart.setOption(option)
  
	let chart2 = echarts.init(oRight)

	// 绑定图表事件
	chart.on('mouseover', function(e){
		setCity(e.name)
  })
	
	// 逻辑处理方法，动态生成右侧的柱状图。两个图表联动
	setCity(datas[0].name) // 默认出现2个图表
  function setCity(name) {
		let data = null
    
    datas.forEach(json => {
      if (json.name == name) {
        data = json
      }
    })
    
    let option = {
      title: {
        text:`${name}省`
      },
      xAxis:[
        type:'categroy',
        data: data.citys.map(city => city.name)
      ],
      yAixs:[
        {
					type:'value'
        }
      ],
      series:[
        {
          name:'city',
          type:'bar',
          data:data.citys.map(city=>city.value)
        }
      ]
    }
		chart2.setOption(option)
  }
}
```

#### 常见的配置控制属性

- 整体图表旋转
  - series 中配置 `startAngle` 属性，直接写起始角度数值
  - 默认是90度的。



## Lodash 库



### 安装

npm i lodash -S



### 引入

哪里用哪里引

```javascript
import debounce from 'lodash/debounce'
```



### 使用

```javascript
onTempChange: debounce(function(v) {
  this.reqMethod.keyWords = v
}, 300),
```



## Element ui 按需引入

### 安装库

`npm i elementui -S`



### 引入库和样式

在 `main.js` 中写这几行

```javascript
import ElementUI from 'element-ui'
import 'element-ui/lib/theme-chalk/index.css'
Vue.use(ElementUI, { locale }) // set ElementUI lang to zh-CN
```



### 配置按需加载

目前我们是全量引入，所以在执行 `npm run build` 后就可以看到体积是多么大。<br />所以要使用按需加载的方式减少打包体积。

- 安装插件

babal 配置, 先安装 `npm install babel-plugin-component -D`

- 修改 `babel.config.js` 文件
```javascript
{
  "presets": [["es2015", { "modules": false }]],
  // 主要是配置这个插件。插件名，按需加载的库，对应的样式库
  "plugins": [
    [
      "component",
      {
        "libraryName": "element-ui",
        "styleLibraryName": "theme-chalk"
      }
    ]
  ]
}
```

- 优化一下 element 引入方式

去 `@/vendor` 新建 `element.js`, 然后就可以按需引入需要的组件了

```javascript
import Vue from 'vue';
import {
  Pagination,
} from 'element-ui';

Vue.use(Pagination);

Vue.use(Loading.directive);

Vue.prototype.$loading = Loading.service;
Vue.prototype.$msgbox = MessageBox;
Vue.prototype.$alert = MessageBox.alert;
Vue.prototype.$confirm = MessageBox.confirm;
Vue.prototype.$prompt = MessageBox.prompt;
Vue.prototype.$notify = Notification;
Vue.prototype.$message = Message;
```

再去 main.js 中引入该文件



### 利用 vue-cli3 的插件引入方式

> 这种方式只推荐在全新项目创建的时候使用，不要在老项目中更改，因为会自动改写一些文件的内容

`vue add element` 就解决了上面所有问题<br />当然在安装的时候会让你选择是否是按需加载。



## 移动端调试工具 vConsole

这是微信提供用于 H5 页面的调试，只要引入，就会出现一个悬浮控件，跟小程序测试版调试一样<br />然后是说用于微信浏览器，但是在普通 H5 也可以使用，这是微信开发的。<br />![](https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200113223626.png)



### vConsole 的作用

当然其中有对 `console.xxx` 各种应用场景的区分<br />有时候输出 `dir`  是更加好的选择，因为输出的是对象的内容，而 `log` 只能输出入源代码一样的信息。另外在浏览器中可以直接调用 `dir` 而不用加 console。
```javascript
// 1 log 普通打印
console.log("Hello world");

// 2 info 信息日志
console.info("Hello world");

// 3 debug 调试日志
console.debug("Hello world");

// 4 warn 警告日志
console.warn("Hello world");

// 5 error 错误日志
console.error("Hello world");

// 6 其他 可以任意输出
console.dir(dom)
```

这样区分的原因就是在该调试工具内有对他们的区分<br />![](https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200113223655.png)



### 安装和引入

安装 `npm i vconsole`<br />以 vue 项目为例，可以单独创建一个文件

```javascript
// @/vendor/vconsole
import VConsole from 'vconsole'
let vConsole = null

// 要区分开发还是生产环境。
if (process.env.NODE_ENV === 'development') {
  vConsole = new VConsole()
}

export default vConsole
```

在 `main.js` 中引入就可以

```javascript
// main.js
import '@/vendor/vconsole'
```

