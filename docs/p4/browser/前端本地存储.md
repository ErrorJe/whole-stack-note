# 前端本地存储

## Cookie

> 就是一种信息的存放，通用性较好

### cookie 特点

- 大小 4KB
- 是用于前端存储，可以设置过期时间，默认是关闭浏览器失效
- 会被携带到 HTTP 头中，所以有一定的带宽消耗



### cookie 操作

客户端（前端）可以通过 `document.cookie` 来设置，服务端可以通过 `Set-Cookie` 设置响应报文字段。

- 原生接口并不友好，所以需要自己封装，也有 js-cookie 库来使用

```js
import Cookies from 'js-cookie'

const TokenKey = 'chistoken'

export function getToken() {
  return Cookies.get(TokenKey)
}

export function setToken(token) {
  return Cookies.set(TokenKey, token)
}

export function removeToken() {
  return Cookies.remove(TokenKey)
}
```

- 原生 JS 实现基础增删改和时效

```js
/* 1 添加cookie
  name 键值对的Key
  value 键值对的value
  expdays cookie过期时间
*/
function setCookie ( name, value, expdays ) {
  var expdate = new Date();
  //设置Cookie过期日期
  expdate.setDate(expdate.getDate() + expdays) ;
  //添加Cookie
  document.cookie = name + "=" + escape(value) + ";expires=" + expdate.toUTCString();
}

// 2 获取cookie
function getCookie ( name ) {
  //获取name在Cookie中起止位置
  var start = document.cookie.indexOf(name+"=") ;

  if ( start != -1 )
  {
    start = start + name.length + 1 ;
    //获取value的终止位置
    var end = document.cookie.indexOf(";", start) ;
    if ( end == -1 )
      end = document.cookie.length ;
    //截获cookie的value值,并返回
    return unescape(document.cookie.substring(start,end)) ;
  }
  return "" ;
}


// 3 删除cookie
function delCookie ( name ) {
  setCookie ( name, "", -1 ) ;
}
```



### cookie 的历史贡献

来自于 MDN 文档，简单来说就是 cookie 是个历史产物，有性能开销，后面推荐使用 localStorage 之类的 API

>  Cookie曾一度用于客户端数据的存储，因当时并没有其它合适的存储办法而作为唯一的存储手段，但现在随着现代浏览器开始支持各种各样的存储方式，Cookie渐渐被淘汰。由于服务器指定Cookie后，浏览器的每次请求都会携带Cookie数据，会带来额外的性能开销（尤其是在移动环境下）。新的浏览器API已经允许开发者直接将数据存储到本地，如使用 [Web storage API](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API) （本地存储和会话存储）或 [IndexedDB](https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API) 



### cookie 的组成

可以通过 chrome 看到所有的信息

![](https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200108160024.png)

- name， value

存放数据的键值对，session 中的 sessionId 其实就是 name 设置的

- domain 当前域名

在父级设置，子级可以拿到

- path 设置路径 `cookie` 生效路径
- max-age 有效期，毫秒（之前 HTTP1 还用过 `expires` ，已废弃）
- size 大小，最大5M
- httpOnly，默认false。设置true后，JS 通过 `document.cookie` 就无法获取了，用于设置比较敏感的字段如 sessionid, token 等
- sameSite 用于跨域共享 cookie 的
- secure 在 HTTPS 中使用，传输过程加密



## LocalStorage

### localStorage 特点

- 存储大小 5MB
- 只能被手动清除
- 以字符串的形式保存，所以遇到对象、数组需要进行序列化



### localStorage 操作

```js
// 1 存
let value = JSON.stringify(data) // 序列化引用类型数据
localStorage.setItem(key, value) 


// 2 取
localStorage.getItem(key) // 单个数据
localStorage.key // 本质就是对象，也可以这样取值
localStorage.valueOf() // 全部数据

// 3 删
localStorage.removeItem(key)
localStorage.clear() // 清空
```



## SessionStorage

### sessionStorage 特点

- 存储大小 5MB
- 仅在当前网页会话下有效，关闭页面或浏览器后就会被清除
- 以字符串的形式保存，所以遇到对象、数组需要进行序列化



### sessionStorage 操作

和 `localStorage` 的操作方式是一样的

```js
// 1 存
sessionStorage.setItem(key, value)

// 2 取
sessionStorage.getItem(key) // 单个数据
sessionStorage.key // 本质就是对象，也可以这样取值
sessionStorage.valueOf() // 全部数据

// 3 删
sessionStorage.removeItem(key)
sessionStorage.clear() // 清空
```



## Session（概念）

### session 特点

- 不是前端技术，区别于 `sessionStorage` ，是后端存储的技术，也是一个抽象概念，用于跟踪会话
- 在后端存储，所以说比 cookie 安全一点
- 场景是服务器需要知道多次 HTTP 请求分别来自于哪个客户端（用户）
- 依赖于客户端 cookie 实现

### session 形式

- SessionID：一般是与数据库中的某个记录关联。用这个 ID 就可以拿到真实的数据
- Token：本身就是真实需要的数据，只是进行了加密。这也是 `JWT` 鉴权方式

### session 载体

根据项目开发习惯，我们一般将后端返回的 `sessionID` 放到 `cookie` 里，把 `token` 放到 `localstorage` 中

然后每次请求时都放到 `Header` 中，定义一个前后端协商好的字段。

