# 字符串的新特性

## 模板字符串 teplstr


### 基本用法

- 使用 `` 包裹字符，还能嵌套
- 使用 ${}来获取变量。
- 如果要使用反引号，则用  \ 转义
- 在模板中的所有`空格`和`换行`都会被保留，如果不要，则在后面使用 `.trim()`消除

```javascript
// ES5 拼接字符串非常不方便
let name = 'wjy', age = 9
let desc = name + "今年" + age + "岁了"

// ES6 字符中可以嵌套变量
let desc2 = `${name}几年${age}岁了`

// 原理实现
function replace(desc) {
  return desc.replace(/\$\{([^}]+)\}/g, fucntion (matched, key) {
     console.log(arguments)
  	 return eval(key)
  })                
}
```



### 常用于 DOM 元素渲染拼接

```javascript
let users = [{id:1, name:'wjy'}, {id:2, name:'wjy2'}]
// 映射为新数组后再映射为字符串
let newList = users.map(user => {
  return `<li>${user.id}:${user.name}</li>`
}).join('')

// 拼接, 模板字符串允许换行
let ul = (`
	<ul>
		${newList}
	</ul>
`)
```



### 执行函数

字符串模板还可以执行函数。
但是若模板中有变量，则没那么简单了，模该的这部分先忽略，不是很常用
```javascript
// 带标签的模板字符串 => 函数调用
// 这种特性是用来自定义模板字符串的
function desc(string, ...params) { // ...xxx 叫其他运算符，只能放在参数列表末尾来收集
  console.log(string)  // 第一个参数是除去变量参数后的文本值数组
  console.log(parmas)  // ...params 将所有其他参数放在数组中
  // 可以自定义返回的模板字符串
  let result = ''
  for (let i=0; i<params.length; i++) {
    result += (string[i]+value[i])
  }
  result += string[string.length-1] // 加上普通文本数组的最后一个元素
  return result.toUpperCase()  // 字母都大写化
}
let str = desc`${name}几年${age}岁了`  // 这里的 desc 做为函数
```



## 字符串特性

### 字符串扩展


#### 字符的多种标识方式

```javascript
'\z' === 'z'  // true
'\172' === 'z' // true
'\x7A' === 'z' // true
'\u007A' === 'z' // true , \uxxxx 格式
'\u{7A}' === 'z' // true， {}大括号包裹码点
```



#### 直接输入字符

> 支持直接输入某个字符，或者其 Unicode 编码


```javascript
'中' === '\u4e2d' // true

// 有5个字符，必须使用转义
U+005C：反斜杠（reverse solidus) // 必须这样写，"\u005c"
U+000D：回车（carriage return）
U+2028：行分隔符（line separator）
U+2029：段分隔符（paragraph separator）
U+000A：换行符（line feed）
```



#### 字符串遍历 for..of..

```javascript
for (let codePoint of 'foo') {
  console.log(codePoint) // f, o, o
}
```



#### ASCII 码相关

```javascript
A-z => 65-90
a-z => 97-122
空格 => 32
换行符 => 10

// 获取字符的 ASCII 码
string.charCodeAt()
```



### 字符串 API



#### 解码（fromCodePoint）和编码（codePointAt）

> 使用的是Unicode 编码


```javascript
// 1 解码， 多个参数会合并成一个字符串。是 String 的静态方法
String.fromCodePoint(0x20BB7)
String.fromCodePoint(0x78, 0x1f680, 0x79) === 'x\uD83D\uDE80y'

// 2 编码，是字符串实例上的方法。每个字符2个字节。对于 0xffff 还要大的编码是4个字节的
'𠮷a'.codePointAt(0) // 134071 可以正确返回4字节的码点。汉字是2字节，a是1字节，所以是3个字符。
```



#### 常用API

> 都是实例方法，也就是只能在字符串实例中使用


```javascript
let s = 'Hello world!';

s.startsWith('Hello'， 2) // true。从索引2开始，是否以 XXX 开头
s.endsWith('!'， 2) // true。前2个字符中，是否以 XXX 结尾
s.includes('o'， 2) // true。从索引2开始，是否包含 X

s.repeat(2) // 将 s 重复拼接2次

// 在头部或尾部增加字符串，以补全指定长度
'123456'.padStart(10, '0') // "0000123456"， 补全固定数字格式
'09-12'.padStart(10, 'YYYY-MM-DD') // "YYYY-09-12"， 用于数据格式化
'x'.padEnd(4, 'ab') // 'xaba', 重复补全

// 去除空格  const s = '  abc  '
s.trim() // "abc"，头尾
s.trimStart() // "abc  "，去头
s.trimEnd() // "  abc"， 去尾
```



#### ES5 API

```javascript
s.indexOf('H') // 0。返回该字符索引，不存在返回 -1 （ES5）
s.lastIndexOf('i') // i 最后一次出现的位置

s.slice(0, 3) // 下标0开始，取3个数
s.slice(2)  // 省略下标，从下标2开始取到底。
s.slice(-3) // 最后3个字符

s.substring(1, 4) // [1,4)之间的字符,不包括结束位置
s.substring(1) // 从索引1开始到结尾

s.toUpperCase() // 全大写
toLowerCase() // 小写

s.search(3) // 查3第一次出现的位置。会跟正则一起用
```


