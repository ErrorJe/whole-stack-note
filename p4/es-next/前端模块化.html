<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端模块化 | FE 前端研究所</title>
    <meta name="description" content="ErrorJE 直辖 Blog">
    <link rel="icon" href="/whole-stack-note/logo.jpg">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/whole-stack-note/assets/css/0.styles.966634b6.css" as="style"><link rel="preload" href="/whole-stack-note/assets/js/app.ea1ba87a.js" as="script"><link rel="preload" href="/whole-stack-note/assets/js/2.6d170185.js" as="script"><link rel="preload" href="/whole-stack-note/assets/js/17.7a625432.js" as="script"><link rel="prefetch" href="/whole-stack-note/assets/js/10.ee1c1979.js"><link rel="prefetch" href="/whole-stack-note/assets/js/11.2d3a5c7c.js"><link rel="prefetch" href="/whole-stack-note/assets/js/12.698342be.js"><link rel="prefetch" href="/whole-stack-note/assets/js/13.bba4ce64.js"><link rel="prefetch" href="/whole-stack-note/assets/js/14.514ef364.js"><link rel="prefetch" href="/whole-stack-note/assets/js/15.9717a3ce.js"><link rel="prefetch" href="/whole-stack-note/assets/js/16.0bd4ce76.js"><link rel="prefetch" href="/whole-stack-note/assets/js/18.7dec8563.js"><link rel="prefetch" href="/whole-stack-note/assets/js/19.b6142803.js"><link rel="prefetch" href="/whole-stack-note/assets/js/20.8636ec75.js"><link rel="prefetch" href="/whole-stack-note/assets/js/21.04fa4e79.js"><link rel="prefetch" href="/whole-stack-note/assets/js/22.0fe18699.js"><link rel="prefetch" href="/whole-stack-note/assets/js/23.27c3f9c7.js"><link rel="prefetch" href="/whole-stack-note/assets/js/24.b8d5d412.js"><link rel="prefetch" href="/whole-stack-note/assets/js/25.b4821ecc.js"><link rel="prefetch" href="/whole-stack-note/assets/js/26.248f71e5.js"><link rel="prefetch" href="/whole-stack-note/assets/js/27.21ab091e.js"><link rel="prefetch" href="/whole-stack-note/assets/js/28.c278c513.js"><link rel="prefetch" href="/whole-stack-note/assets/js/29.45b2b41e.js"><link rel="prefetch" href="/whole-stack-note/assets/js/3.e21bb9ed.js"><link rel="prefetch" href="/whole-stack-note/assets/js/30.5306cc0a.js"><link rel="prefetch" href="/whole-stack-note/assets/js/31.ffc6af5d.js"><link rel="prefetch" href="/whole-stack-note/assets/js/32.c57e0de5.js"><link rel="prefetch" href="/whole-stack-note/assets/js/33.5052f7bb.js"><link rel="prefetch" href="/whole-stack-note/assets/js/34.21cf407f.js"><link rel="prefetch" href="/whole-stack-note/assets/js/35.7e8a0533.js"><link rel="prefetch" href="/whole-stack-note/assets/js/36.522ec4e0.js"><link rel="prefetch" href="/whole-stack-note/assets/js/37.7a046e5d.js"><link rel="prefetch" href="/whole-stack-note/assets/js/38.dc62a422.js"><link rel="prefetch" href="/whole-stack-note/assets/js/39.4a8bd683.js"><link rel="prefetch" href="/whole-stack-note/assets/js/4.761b99d2.js"><link rel="prefetch" href="/whole-stack-note/assets/js/40.697e2746.js"><link rel="prefetch" href="/whole-stack-note/assets/js/41.b5bc2f1e.js"><link rel="prefetch" href="/whole-stack-note/assets/js/42.76587e36.js"><link rel="prefetch" href="/whole-stack-note/assets/js/43.1ffc8a5a.js"><link rel="prefetch" href="/whole-stack-note/assets/js/44.d005d44f.js"><link rel="prefetch" href="/whole-stack-note/assets/js/45.12f7b441.js"><link rel="prefetch" href="/whole-stack-note/assets/js/46.051de490.js"><link rel="prefetch" href="/whole-stack-note/assets/js/47.ba666a2d.js"><link rel="prefetch" href="/whole-stack-note/assets/js/48.7c21509a.js"><link rel="prefetch" href="/whole-stack-note/assets/js/49.afdabb19.js"><link rel="prefetch" href="/whole-stack-note/assets/js/5.8b0953b8.js"><link rel="prefetch" href="/whole-stack-note/assets/js/50.7d756262.js"><link rel="prefetch" href="/whole-stack-note/assets/js/51.d4377517.js"><link rel="prefetch" href="/whole-stack-note/assets/js/52.35e62bcf.js"><link rel="prefetch" href="/whole-stack-note/assets/js/53.e2fc60f1.js"><link rel="prefetch" href="/whole-stack-note/assets/js/54.b46a71f2.js"><link rel="prefetch" href="/whole-stack-note/assets/js/55.10452e76.js"><link rel="prefetch" href="/whole-stack-note/assets/js/56.828ecf81.js"><link rel="prefetch" href="/whole-stack-note/assets/js/57.51526869.js"><link rel="prefetch" href="/whole-stack-note/assets/js/58.ed06a6f2.js"><link rel="prefetch" href="/whole-stack-note/assets/js/59.938dd3ad.js"><link rel="prefetch" href="/whole-stack-note/assets/js/6.4336baf3.js"><link rel="prefetch" href="/whole-stack-note/assets/js/60.c72fc9a5.js"><link rel="prefetch" href="/whole-stack-note/assets/js/61.659d5f95.js"><link rel="prefetch" href="/whole-stack-note/assets/js/62.c800445a.js"><link rel="prefetch" href="/whole-stack-note/assets/js/63.5c840a2c.js"><link rel="prefetch" href="/whole-stack-note/assets/js/64.80d4f25e.js"><link rel="prefetch" href="/whole-stack-note/assets/js/65.e98cde82.js"><link rel="prefetch" href="/whole-stack-note/assets/js/66.2bd00499.js"><link rel="prefetch" href="/whole-stack-note/assets/js/67.3076faa8.js"><link rel="prefetch" href="/whole-stack-note/assets/js/68.e742fe29.js"><link rel="prefetch" href="/whole-stack-note/assets/js/69.0f98d2df.js"><link rel="prefetch" href="/whole-stack-note/assets/js/7.da34982c.js"><link rel="prefetch" href="/whole-stack-note/assets/js/70.5de7e3b3.js"><link rel="prefetch" href="/whole-stack-note/assets/js/71.ff7053ed.js"><link rel="prefetch" href="/whole-stack-note/assets/js/72.0f329105.js"><link rel="prefetch" href="/whole-stack-note/assets/js/73.a0b195aa.js"><link rel="prefetch" href="/whole-stack-note/assets/js/74.a3eb8da2.js"><link rel="prefetch" href="/whole-stack-note/assets/js/75.3b7d7756.js"><link rel="prefetch" href="/whole-stack-note/assets/js/76.5cf3f6e7.js"><link rel="prefetch" href="/whole-stack-note/assets/js/77.7332426b.js"><link rel="prefetch" href="/whole-stack-note/assets/js/78.61278e7e.js"><link rel="prefetch" href="/whole-stack-note/assets/js/79.7f1c52cb.js"><link rel="prefetch" href="/whole-stack-note/assets/js/8.5f8f0f1a.js"><link rel="prefetch" href="/whole-stack-note/assets/js/80.3a17621d.js"><link rel="prefetch" href="/whole-stack-note/assets/js/81.0e3fd4a2.js"><link rel="prefetch" href="/whole-stack-note/assets/js/82.4fe176a1.js"><link rel="prefetch" href="/whole-stack-note/assets/js/83.efcec134.js"><link rel="prefetch" href="/whole-stack-note/assets/js/84.e0ee5c90.js"><link rel="prefetch" href="/whole-stack-note/assets/js/85.5f244030.js"><link rel="prefetch" href="/whole-stack-note/assets/js/86.9f81d467.js"><link rel="prefetch" href="/whole-stack-note/assets/js/87.899d0000.js"><link rel="prefetch" href="/whole-stack-note/assets/js/88.94d6b9f6.js"><link rel="prefetch" href="/whole-stack-note/assets/js/89.5e1e17f1.js"><link rel="prefetch" href="/whole-stack-note/assets/js/9.7a222e22.js">
    <link rel="stylesheet" href="/whole-stack-note/assets/css/0.styles.966634b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/whole-stack-note/" class="home-link router-link-active"><!----> <span class="site-name">FE 前端研究所</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/whole-stack-note/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端初级" class="dropdown-title"><span class="title">前端初级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML / CSS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/html-base/" class="nav-link">HTML 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/html-pro/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/css-base/" class="nav-link">CSS 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/css-pro/" class="nav-link">CSS3 / CSS4</a></li></ul></li><li class="dropdown-item"><h4>JS 基础与进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/es-next/" class="nav-link router-link-active">ES-Next</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/jquery/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/browser/" class="nav-link">浏览器原理</a></li></ul></li><li class="dropdown-item"><h4>项目包管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/package/npm/" class="nav-link">NPM</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/package/yarn/" class="nav-link">YARN</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/package/learn/" class="nav-link">LEARN</a></li></ul></li><li class="dropdown-item"><h4>团队协作</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/team/code-format/" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/team/tools/" class="nav-link">开发工具链</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端中级" class="dropdown-title"><span class="title">前端中级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>移动端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/h5/" class="nav-link">H5</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/uni-app/" class="nav-link">Uni-App</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/react-native/" class="nav-link">React Native</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/fullter/" class="nav-link">Fullter</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/wechat/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/weex/" class="nav-link">Weex</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/mpvue/" class="nav-link">MpVue</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/pwa/" class="nav-link">PWA</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/native-app/" class="nav-link">Native App</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/hybird-app/" class="nav-link">Hybird App</a></li></ul></li><li class="dropdown-item"><h4>开发框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/vue-base/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/vue-element-admin/" class="nav-link">Vue-Element-Admin</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/react-base/" class="nav-link">React</a></li></ul></li><li class="dropdown-item"><h4>NodeJS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/node-js/node-base/" class="nav-link">Node 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/node-js/express.html" class="nav-link">Express</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/node-js/koa.html" class="nav-link">Koa</a></li></ul></li><li class="dropdown-item"><h4>面试相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/interview/business/" class="nav-link">业务开发</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/interview/topic/" class="nav-link">面试题</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端高级" class="dropdown-title"><span class="title">前端高级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whole-stack-note/p6/functional/" class="nav-link">函数式编程</a></li><li class="dropdown-item"><h4>Vue 源码</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/vue-pro/" class="nav-link">Vue 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/vue-pro/" class="nav-link">Vue-Router 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/vue-pro/" class="nav-link">Vuex 原理</a></li></ul></li><li class="dropdown-item"><h4>React 源码</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/react-pro/" class="nav-link">React 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/react-pro/" class="nav-link">React-Router 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/react-pro/" class="nav-link">React-Redux 原理</a></li></ul></li><li class="dropdown-item"><h4>数据库与缓存</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/database/mysql/" class="nav-link">Mysql</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/database/mongodb/" class="nav-link">Mongodb</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/database/redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>前端工程化</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/gulp/" class="nav-link">Gulp</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/mock-server/" class="nav-link">Mock Server</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/icon-font/" class="nav-link">IconFont</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/axios-api/" class="nav-link">Axios 与 API 管理</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/performance/" class="nav-link">性能优化</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/test/" class="nav-link">自动化测试</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/deployment/" class="nav-link">自动化部署与运维</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/network/" class="nav-link">网络协议与安全</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/algorithms/" class="nav-link">数据结构与算法</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/patterns/" class="nav-link">设计模式</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端基础" class="dropdown-title"><span class="title">后端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whole-stack-note/back/java-se/" class="nav-link">JAVA SE</a></li><li class="dropdown-item"><h4>Spring 全家桶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/spring/spring-base/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/spring/spring-boot/" class="nav-link">SpringBoot</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/spring/spring-cloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>包管理工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/package/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/package/gradle/" class="nav-link">Gradle</a></li></ul></li><li class="dropdown-item"><h4>数据库与缓存</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/sql/" class="nav-link">SQL 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/oracle/" class="nav-link">Oracle</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/mongodb/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/performance/" class="nav-link">数据库高级优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端进阶" class="dropdown-title"><span class="title">后端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>服务器部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/server/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/server/mac/" class="nav-link">Max</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/server/nginx/" class="nav-link">Nginx</a></li></ul></li><li class="dropdown-item"><h4>搜索引擎</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/search/elastic-search/" class="nav-link">Elastic Search</a></li></ul></li><li class="dropdown-item"><h4>RPC 框架和中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/dubbo/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/rabbit-mq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/rockert-mq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/active-mq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>虚拟化容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/container/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/container/k8s/" class="nav-link">K8S</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whole-stack-note/blog/live/" class="nav-link">记录</a></li><li class="dropdown-item"><!----> <a href="/whole-stack-note/blog/economics/" class="nav-link">经济学</a></li></ul></div></div><div class="nav-item"><a href="/whole-stack-note/my-resume.html" class="nav-link">Resume</a></div> <a href="https://github.com/ErrorJe" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/whole-stack-note/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端初级" class="dropdown-title"><span class="title">前端初级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML / CSS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/html-base/" class="nav-link">HTML 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/html-pro/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/css-base/" class="nav-link">CSS 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/css-pro/" class="nav-link">CSS3 / CSS4</a></li></ul></li><li class="dropdown-item"><h4>JS 基础与进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/es-next/" class="nav-link router-link-active">ES-Next</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/jquery/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/browser/" class="nav-link">浏览器原理</a></li></ul></li><li class="dropdown-item"><h4>项目包管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/package/npm/" class="nav-link">NPM</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/package/yarn/" class="nav-link">YARN</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/package/learn/" class="nav-link">LEARN</a></li></ul></li><li class="dropdown-item"><h4>团队协作</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p4/team/code-format/" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p4/team/tools/" class="nav-link">开发工具链</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端中级" class="dropdown-title"><span class="title">前端中级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>移动端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/h5/" class="nav-link">H5</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/uni-app/" class="nav-link">Uni-App</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/react-native/" class="nav-link">React Native</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/fullter/" class="nav-link">Fullter</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/wechat/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/weex/" class="nav-link">Weex</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/mpvue/" class="nav-link">MpVue</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/pwa/" class="nav-link">PWA</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/native-app/" class="nav-link">Native App</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/web-app/hybird-app/" class="nav-link">Hybird App</a></li></ul></li><li class="dropdown-item"><h4>开发框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/vue-base/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/vue-element-admin/" class="nav-link">Vue-Element-Admin</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/react-base/" class="nav-link">React</a></li></ul></li><li class="dropdown-item"><h4>NodeJS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/node-js/node-base/" class="nav-link">Node 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/node-js/express.html" class="nav-link">Express</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/node-js/koa.html" class="nav-link">Koa</a></li></ul></li><li class="dropdown-item"><h4>面试相关</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p5/interview/business/" class="nav-link">业务开发</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p5/interview/topic/" class="nav-link">面试题</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端高级" class="dropdown-title"><span class="title">前端高级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whole-stack-note/p6/functional/" class="nav-link">函数式编程</a></li><li class="dropdown-item"><h4>Vue 源码</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/vue-pro/" class="nav-link">Vue 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/vue-pro/" class="nav-link">Vue-Router 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/vue-pro/" class="nav-link">Vuex 原理</a></li></ul></li><li class="dropdown-item"><h4>React 源码</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/react-pro/" class="nav-link">React 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/react-pro/" class="nav-link">React-Router 原理</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/react-pro/" class="nav-link">React-Redux 原理</a></li></ul></li><li class="dropdown-item"><h4>数据库与缓存</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/database/mysql/" class="nav-link">Mysql</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/database/mongodb/" class="nav-link">Mongodb</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/database/redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>前端工程化</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/gulp/" class="nav-link">Gulp</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/mock-server/" class="nav-link">Mock Server</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/icon-font/" class="nav-link">IconFont</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/project/axios-api/" class="nav-link">Axios 与 API 管理</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/p6/performance/" class="nav-link">性能优化</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/test/" class="nav-link">自动化测试</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/deployment/" class="nav-link">自动化部署与运维</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/network/" class="nav-link">网络协议与安全</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/algorithms/" class="nav-link">数据结构与算法</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/p6/patterns/" class="nav-link">设计模式</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端基础" class="dropdown-title"><span class="title">后端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whole-stack-note/back/java-se/" class="nav-link">JAVA SE</a></li><li class="dropdown-item"><h4>Spring 全家桶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/spring/spring-base/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/spring/spring-boot/" class="nav-link">SpringBoot</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/spring/spring-cloud/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>包管理工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/package/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/package/gradle/" class="nav-link">Gradle</a></li></ul></li><li class="dropdown-item"><h4>数据库与缓存</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/sql/" class="nav-link">SQL 基础</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/oracle/" class="nav-link">Oracle</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/mongodb/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/database/performance/" class="nav-link">数据库高级优化</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端进阶" class="dropdown-title"><span class="title">后端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>服务器部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/server/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/server/mac/" class="nav-link">Max</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/server/nginx/" class="nav-link">Nginx</a></li></ul></li><li class="dropdown-item"><h4>搜索引擎</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/search/elastic-search/" class="nav-link">Elastic Search</a></li></ul></li><li class="dropdown-item"><h4>RPC 框架和中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/dubbo/" class="nav-link">Dubbo</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/rabbit-mq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/rockert-mq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/active-mq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/middleware/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>虚拟化容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whole-stack-note/back/container/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/whole-stack-note/back/container/k8s/" class="nav-link">K8S</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whole-stack-note/blog/live/" class="nav-link">记录</a></li><li class="dropdown-item"><!----> <a href="/whole-stack-note/blog/economics/" class="nav-link">经济学</a></li></ul></div></div><div class="nav-item"><a href="/whole-stack-note/my-resume.html" class="nav-link">Resume</a></div> <a href="https://github.com/ErrorJe" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/whole-stack-note/p4/es-next/前端模块化.html" class="active sidebar-link">前端模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#模块化概念" class="sidebar-link">模块化概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#模块化原则" class="sidebar-link">模块化原则</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#模块化意义" class="sidebar-link">模块化意义</a></li></ul></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#模块化演进和未来趋势" class="sidebar-link">模块化演进和未来趋势</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#早期假模块化时代" class="sidebar-link">早期假模块化时代</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#commonjs-时代" class="sidebar-link">CommonJS 时代</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#amd-时代" class="sidebar-link">AMD 时代</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#cmd-时代" class="sidebar-link">CMD 时代</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#umd-时代" class="sidebar-link">UMD 时代</a></li></ul></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#es6-原生模块化（esm）" class="sidebar-link">ES6 原生模块化（ESM）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#基础知识" class="sidebar-link">基础知识</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#es-next-的版本" class="sidebar-link">ES Next 的版本</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#导出和导入操作" class="sidebar-link">导出和导入操作</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#在浏览器中使用-es-模块化" class="sidebar-link">在浏览器中使用 ES 模块化</a></li></ul></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#node-中的模块" class="sidebar-link">Node 中的模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#export-和-module-对象" class="sidebar-link">export 和 module 对象</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#导入和导出" class="sidebar-link">导入和导出</a></li></ul></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#script-模块" class="sidebar-link">Script 模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#script-标签引入的方式" class="sidebar-link">script 标签引入的方式</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#画几张图简要说明" class="sidebar-link">画几张图简要说明</a></li><li class="sidebar-sub-header"><a href="/whole-stack-note/p4/es-next/前端模块化.html#推荐的应用场景" class="sidebar-link">推荐的应用场景</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端模块化"><a href="#前端模块化" class="header-anchor">#</a> 前端模块化</h1> <h2 id="模块化概念"><a href="#模块化概念" class="header-anchor">#</a> 模块化概念</h2> <h3 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h3> <p>将复杂代码，针对其功能原子性进行拆分成几个互相独立的文件。内部完成逻辑，对外暴露一些数据或调用方法，与外部完成整合。</p> <p>模块化和工程化结合，又有很多新的概念。</p> <p>在 nodejs 中，一个 JS 文件都是模块</p> <h3 id="模块化原则"><a href="#模块化原则" class="header-anchor">#</a> 模块化原则</h3> <ul><li>复用性</li> <li>组合性</li> <li>中心化</li> <li>独立性</li></ul> <h3 id="模块化意义"><a href="#模块化意义" class="header-anchor">#</a> 模块化意义</h3> <ul><li>避免命名冲突。每个文件是模块，其中变量函数都是其私有变量。不会污染或被全局变量污染</li> <li>更清晰的依赖关系。要显式声明对模块的引用，文件直接依赖关系明确。</li> <li>高可维护性。模块功能职责单一，需要升级改动部分功能只需要针对具体模块进行改动。</li> <li>高可复用性。</li> <li>降低复杂度。解决代码的高内聚低耦合</li></ul> <h2 id="模块化演进和未来趋势"><a href="#模块化演进和未来趋势" class="header-anchor">#</a> 模块化演进和未来趋势</h2> <p>主要经历了三个阶段</p> <ul><li>模拟的“假”模块化时代</li> <li>规范标准时代</li> <li>ES 原生时代</li></ul> <p>每一次技术更迭，都在上一个时代技术的基础上演变。</p> <blockquote><p>前端模块化各个标准的区别。https://juejin.im/post/5aaa37c8f265da23945f365c</p></blockquote> <h3 id="早期假模块化时代"><a href="#早期假模块化时代" class="header-anchor">#</a> 早期假模块化时代</h3> <h4 id="函数模式"><a href="#函数模式" class="header-anchor">#</a> 函数模式</h4> <p>借助 JS 函数作用域来模拟实现“假”的模块化。</p> <p>缺点也很明显，不能保证不污染全局变量，没有解决问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 早期的 JS 作用域只有全局和函数作用域</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="对象模式"><a href="#对象模式" class="header-anchor">#</a> 对象模式</h4> <p>利用对象，实现命名空间（对象属性的键值对）的概念。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    foo<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">f11</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">f11</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//... },</span>
    <span class="token function-variable function">f12</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">f12</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//... },</span>
<span class="token punctuation">}</span>
module1<span class="token punctuation">.</span><span class="token function">f11</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 模拟命名空间调用方法</span>
module1<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token comment">// 同样，任何人可以改变值，不安全</span>
</code></pre></div><h4 id="iife-模式"><a href="#iife-模式" class="header-anchor">#</a> IIFE 模式</h4> <p>利用闭包（IIFE，立即执行函数）。构造一个私有作用域，再用闭包把数据和接口输出。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1 IIFE 模块</span>
<span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span>
    <span class="token keyword">var</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        fn1<span class="token operator">:</span> fn1<span class="token punctuation">,</span>
        fn2<span class="token operator">:</span> fn2
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 2 调用</span>
module<span class="token punctuation">.</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>foo <span class="token comment">// undefined， 因为变量没有被 return 所以说是一个私有的</span>
</code></pre></div><h4 id="iife-进阶版：现代模块化基石"><a href="#iife-进阶版：现代模块化基石" class="header-anchor">#</a> IIFE 进阶版：现代模块化基石</h4> <p>进阶版本，就是将 IIFE 挂载到 window 上。这样能够完全做到私有化。</p> <p>符合一个模块的所有初级条件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1 传入 window 对象</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">'xxxx'</span>

    <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo executing, data is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> <span class="token string">'modified data'</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">bar executing, data is now </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span>module1 <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token comment">// 2 挂载到 window 上</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>

<span class="token comment">// 2 如果 module1 没有提供暴露数据或者修改的方法，则无法去读写</span>
module1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// foo executing, data is xxxx</span>
</code></pre></div><p>如果要依赖其他模块，则在定义的时候，传入2个参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> $</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">'xxxx'</span>

    <span class="token keyword">function</span> <span class="token constant">JQ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    window<span class="token punctuation">.</span>module1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token constant">JQ</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> jQuery<span class="token punctuation">)</span>
</code></pre></div><h3 id="commonjs-时代"><a href="#commonjs-时代" class="header-anchor">#</a> CommonJS 时代</h3> <blockquote><p>CommonJS 是 NodeJS 带来的。在 Node 中，每一个文件就是一个模块，具有单独的作用域。</p> <p>浅谈前端模块化</p> <p>https://juejin.im/post/5c1619b8e51d4530e8357c86</p></blockquote> <h4 id="commonjs-中几个重要规范"><a href="#commonjs-中几个重要规范" class="header-anchor">#</a> CommonJS 中几个重要规范</h4> <ul><li><p>文件=模块。文件内代码都运行在独立的作用域，不会污染全局空间</p></li> <li><p>模块可复用加载。首次加载被“缓存”，后面加载都读取缓存。</p></li> <li><p>加载某个模块，就是引入该模块的 “module.exports” 属性</p></li> <li><ul><li>“module.exports” 属性输出的是一个拷贝后的值，输出后就算影响模块，也不会影响这个输出</li></ul></li> <li><p>模块加载顺序按照代码引入次序（同步）</p></li> <li><ul><li>所以适用于服务端和桌面端</li></ul></li> <li><p>注意 “module.exports”  和 “exports” 是不一样的</p></li></ul> <h4 id="模拟实现-commonjs"><a href="#模拟实现-commonjs" class="header-anchor">#</a> 模拟实现 CommonJS</h4> <p>在浏览器中实现，就是实现 <code>module.exports</code> 和<code>require</code> 方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 根据 require 的文件路径，加载文件内容并执行，同时将对外接口进行缓存。</span>
<span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 借助立即执行函数，将 module 和 module.exports 对象进行赋值</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...  </span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h4> <p>CommonJS 规范模块的加载采用同步加载方式，适用于 Node.js 端。</p> <p>因为服务端文件是在本地的，加载很快</p> <p>浏览器环境，资源都是从服务器下载后才能使用。同步会阻塞 JS 运行。</p> <h3 id="amd-时代"><a href="#amd-时代" class="header-anchor">#</a> AMD 时代</h3> <p>因为 <code>NodeJS</code> 运行在服务器上，所有文件都是在本地硬盘了，所以是同步加载的。浏览器环境一般都是异步去加载其他服务器中的模块。同步就不合适了。</p> <p>所以在浏览器的异步加载环境，使用 <code>AMD</code> 异步并行加载依赖模块，且可以有效管理文件依赖关系和加载顺序。</p> <h4 id="requirejs-库"><a href="#requirejs-库" class="header-anchor">#</a> RequireJS 库</h4> <blockquote><p>https://github.com/requirejs/requirejs</p></blockquote> <p>AMD 规范，规定了如何定义模块、如何对外输出、如何引入依赖。所以 <code>require.js</code>  库就是实现这些规范的典型库。通过 <code>define</code> 方法定义模块，通过 <code>require</code> 方法实现模块加载。</p> <h4 id="全局注入-require-js-的-2-个方法"><a href="#全局注入-require-js-的-2-个方法" class="header-anchor">#</a> 全局注入 require.js 的 2 个方法</h4> <p>这2个方法也是 <code>require.js</code> 在全局注入的函数。</p> <p>下面是源码部分，理解思路，不用学实现。</p> <p>利用 IIFE 将全局对象 <code>this</code> 和 <code>setTimeout</code> 传入函数体内</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> require<span class="token punctuation">,</span> define<span class="token punctuation">;</span> <span class="token comment">//  1 全局定义方法</span>
<span class="token comment">// 2 将全局对象（this）和 setTimeout 传入函数体内</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global<span class="token punctuation">,</span> setTimeout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setTimeout <span class="token operator">===</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> setTimeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="define-方法"><a href="#define-方法" class="header-anchor">#</a> define 方法</h4> <p><code>define</code> 方法，主要是将依赖加入依赖队列</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">define</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> deps<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>defQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>name<span class="token punctuation">,</span> deps<span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>defQueueMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    globalDefQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>name<span class="token punctuation">,</span> deps<span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="require-方法"><a href="#require-方法" class="header-anchor">#</a> require 方法</h4> <p><code>require</code> 方法是完成 <code>script</code> 标签的创建，再去请求相应的模块，对模块进行加载和执行</p> <div class="language-js extra-class"><pre class="language-js"><code>req<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> moduleName<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">(</span>context <span class="token operator">&amp;&amp;</span> context<span class="token punctuation">.</span>config<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      node<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//create a async script element</span>
    node <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">createNode</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> moduleName<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//add Events [onreadystatechange,load,error]</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">//set url for loading</span>
    node<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>

    <span class="token comment">//insert script element to head and start load</span>
    currentlyAddingScript <span class="token operator">=</span> node<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>baseElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      head<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> baseElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      currentlyAddingScript <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isWebWorker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//.........</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token function-variable function">createNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> moduleName<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> node <span class="token operator">=</span> config<span class="token punctuation">.</span>xhtml <span class="token operator">?</span>
        document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span><span class="token string">'http://www.w3.org/1999/xhtml'</span><span class="token punctuation">,</span> <span class="token string">'html:script'</span><span class="token punctuation">)</span> <span class="token operator">:</span>
    document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>type <span class="token operator">=</span> config<span class="token punctuation">.</span>scriptType <span class="token operator">||</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="remove-方法"><a href="#remove-方法" class="header-anchor">#</a> remove 方法</h4> <p>最后创建的 script 标签，在模块加入内容后，就没有用了。删除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">removeScript</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">each</span><span class="token punctuation">(</span><span class="token function">scripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">scriptNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>scriptNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-requiremodule'</span><span class="token punctuation">)</span> <span class="token operator">===</span> name <span class="token operator">&amp;&amp;</span>
          scriptNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-requirecontext'</span><span class="token punctuation">)</span> <span class="token operator">===</span> context<span class="token punctuation">.</span>contextName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scriptNode<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>scriptNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="入口配置文件-require-config"><a href="#入口配置文件-require-config" class="header-anchor">#</a> 入口配置文件 require.config</h4> <p>依赖数组中指出依赖的模块。指定的模块名称，可以去配置文件中去定义路径</p> <p><code>require.config</code> 用于配置这些模块信息。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./main.js 入口文件</span>
require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseUrl<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  paths<span class="token operator">:</span> <span class="token punctuation">{</span>
    setBodyColor<span class="token operator">:</span> <span class="token string">'./setBodyColor'</span><span class="token punctuation">,</span>
    jquery<span class="token operator">:</span> <span class="token string">'./jquery-3.4.0'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用在 main.js 中配置的模块名，而不用写路径</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'calc'</span><span class="token punctuation">,</span><span class="token string">'setBodyColor'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">calc<span class="token punctuation">,</span> setBodyColor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>calc<span class="token punctuation">.</span><span class="token function">circumference</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setBodyColor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cmd-时代"><a href="#cmd-时代" class="header-anchor">#</a> CMD 时代</h3> <p>结合了 <code>CommonJS</code> 和 <code>AMD</code> 规范的特点。类似 <code>requireJS</code> ，<code>CMD</code> 规范的实现为 <code>sea.js</code>。</p> <p>两者基本是一样的。</p> <h4 id="cmd-和-amd-的区别"><a href="#cmd-和-amd-的区别" class="header-anchor">#</a> CMD 和 AMD 的区别</h4> <ul><li>AMD 要异步加载模块。CMD 在 require 依赖时用同步的形式（require），也可以用异步方法（require.async）</li> <li>AMD 遵循前置原则（依赖提前在依赖数组中声明），CMD 遵循依赖就近原则（用依赖前 require 进来就好了）。</li></ul> <h4 id="cmd-模块定义"><a href="#cmd-模块定义" class="header-anchor">#</a> CMD 模块定义</h4> <h5 id="无依赖模块"><a href="#无依赖模块" class="header-anchor">#</a> 无依赖模块</h5> <p>传入一个回调，用于定义模块的代码逻辑</p> <p>用 <code>module.exports</code> 或 <code>exports</code> 对象将接口对外暴露出去</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./calc.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">PI</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Math<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">area</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">circumference</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token operator">*</span> r<span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>area<span class="token punctuation">,</span> circumference<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="定义有依赖的模块"><a href="#定义有依赖的模块" class="header-anchor">#</a> 定义有依赖的模块</h5> <p>使用 <code>require()</code> 方法来加载其他的依赖模块。</p> <p><code>CMD</code> 是就近依赖，延迟执行。用到的时候才用 <code>require</code> 方法，且在实际调用时被执行。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./setBodyColor.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">setBodyColor</span> <span class="token operator">=</span> <span class="token parameter">color</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background-color'</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> setBodyColor
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="模块的使用"><a href="#模块的使用" class="header-anchor">#</a> 模块的使用</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;./sea.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
  <span class="token comment">// 加载入口模块</span>
  seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'./main'</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// ./main.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> setBodyColor <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'setBodyColor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
  <span class="token function">setBodyColor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="umd-时代"><a href="#umd-时代" class="header-anchor">#</a> UMD 时代</h3> <blockquote><p>umd 统一模块，支持所有模块</p></blockquote> <p>相当于一个集合，允许在环境中同时使用 <code>AMD</code> 和<code>CommonJS</code> 规范。</p> <p>核心设计：利用<code>IIFE</code> 根据环境来判断需要的参数类别</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// AMD 规范</span>
        <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 类 Node 环境，并不支持完全严格的 CommonJS 规范</span>
        <span class="token comment">// 但是属于 CommonJS-like 环境，支持 module.exports 用法</span>
        module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 浏览器环境</span>
        root<span class="token punctuation">.</span>returnExports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回值作为 export 内容</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="es6-原生模块化（esm）"><a href="#es6-原生模块化（esm）" class="header-anchor">#</a> ES6 原生模块化（ESM）</h2> <h3 id="基础知识"><a href="#基础知识" class="header-anchor">#</a> 基础知识</h3> <p><code>ES6 module</code> 自动采用严格模式，无论是否在文件顶部增加 <code>use strict</code>。严格模式带来一系列的代码限制</p> <ul><li>变量必须声明后再使用</li> <li>不能删除变量，只能删除属性如 <code>delete obj[prop]</code></li> <li><code>arguments</code> 不会自动反映函数参数的变化</li> <li>禁止 <code>this</code> 指向全局对象。顶层 <code>this</code> 是 <code>Undefined</code>,所以不要在全局环境使用 <code>this</code></li> <li>增加 <code>protected</code>, <code>static</code>, <code>interface</code> 等保留字</li></ul> <h3 id="es-next-的版本"><a href="#es-next-的版本" class="header-anchor">#</a> ES Next 的版本</h3> <ul><li>stage - 0 计划（功能最多）</li> <li>stage - 1 减少</li> <li>stage - 2 最少 （babel/preset-env 来整合这些草案）</li> <li>stage - 3 定版</li></ul> <h4 id="esm-与-commonjs-的区别"><a href="#esm-与-commonjs-的区别" class="header-anchor">#</a> ESM 与 CommonJS 的区别</h4> <h5 id="esm-的设计思想（静态化）"><a href="#esm-的设计思想（静态化）" class="header-anchor">#</a> ESM 的设计思想（静态化）</h5> <p>ESM 的设计思想就是尽量保证静态化，这样能够在“编译时”有几个好处</p> <ul><li>确定模块之间的依赖关系</li> <li>每个模块的输入输出都是确定的</li></ul> <h5 id="其他规范的设计区别"><a href="#其他规范的设计区别" class="header-anchor">#</a> 其他规范的设计区别</h5> <p>CommonJS 和 AMD 模块无法在前置时确定模块之间的关系，也无法保证 IO 关系，而只能在“运行时”去确定。实际上，CMJ 导出的就是对象。</p> <ul><li>且 CommonJS 输出的是一个值的——拷贝，而 ES 模块输出的是值的——引用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// data.js 用 ESM 规范导出1个变量和方法</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">'data'</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">modifyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token string">'modified data'</span>
<span class="token punctuation">}</span>

<span class="token comment">// index.js 调用方法，可以看到 data.js 中的值发生改变，说明是导出的是引用</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> modifyData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./data'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// data</span>
<span class="token function">modifyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用模块方法，改变 data 值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// modified data</span>
</code></pre></div><p>一样的操作，看 CMJ 规范的结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// data.js </span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">'data'</span>
<span class="token keyword">function</span> <span class="token function">modifyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token string">'modified data'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用 CMJ 规范导出1个变量和方法</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> data<span class="token punctuation">,</span>
    modifyData<span class="token operator">:</span> modifyData
<span class="token punctuation">}</span>

<span class="token comment">// index.js 引入两个导出值</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data
<span class="token keyword">var</span> modifyData <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>modifyData
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// data</span>
<span class="token function">modifyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用方法后，发现，原模块中的变量值没发生改变。说明是值的新拷贝</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// data</span>
</code></pre></div><h4 id="esm-设计成静态化的原因"><a href="#esm-设计成静态化的原因" class="header-anchor">#</a> ESM 设计成静态化的原因</h4> <p>提高运行性能，减少代码体积。通过分析导入的依赖是否被使用以决定是否加载该模块。</p> <p>但是，ESM的静态化同样也有限制</p> <ul><li>只能在文件顶部使用 import 来导入依赖（编译时加载/静态加载）</li> <li>且模块名只能是字符串常量，而不能是动态的变量替代</li> <li>export 导出的变量类型严格限制</li></ul> <p>这样限制的目的，也是为了通过作用域分析，可以确定代码里变量所属的作用域以及他们之间的引用关系。</p> <h4 id="原生-es-模块应用场景"><a href="#原生-es-模块应用场景" class="header-anchor">#</a> 原生 ES 模块应用场景</h4> <p>由于该标准是语言层面的，所以在使用工程化 webpack， 或者开发前端库，都建议使用原生的 ES 模块。</p> <p>NodeJS 的 CommonJS 也逐步向原生 ES 模块转移，目前需要使用 CommonJS 的地方仅仅是在 Node 中。</p> <h4 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h4> <h5 id="基础知识-2"><a href="#基础知识-2" class="header-anchor">#</a> 基础知识</h5> <p>基于 ESM， 在模块没有明显引用时，就可以进行去冗余。这就是 tree shaking。</p> <p>主要目的就是减少应用中写了，但是没有被用到的 JS 代码，这样文件的体积更小，打包后的 bundle 体积也小，对用户体验有积极作用</p> <p>tree shaking 处理的时机在打包之前。就像是做蛋糕，把蛋壳剥离，然后留下蛋清和蛋黄。</p> <blockquote><p>（DCE，dead code elimination 处理方式相反，做出蛋糕后再去找蛋壳）</p></blockquote> <p>到最后，该技术也只是辅助手段。良好的模块拆分和设计才是减少代码体积的关键。</p> <h5 id="局限性"><a href="#局限性" class="header-anchor">#</a> 局限性</h5> <p>也有 tree shaking 无法清除的无用代码。但是不建议马上用 webpack 去构建它的解决方案，基本使用和操作方法可以参照文档，或者看其他企业的实施。</p> <ul><li>https://mp.weixin.qq.com/s/Y4v7tAWUeDNs_FWpUnKmAw</li> <li>https://juejin.im/post/5b8ce49df265da438151b468</li> <li>https://juejin.im/post/5a4dc842518825698e7279a9</li></ul> <h3 id="导出和导入操作"><a href="#导出和导入操作" class="header-anchor">#</a> 导出和导入操作</h3> <h4 id="export-和-export-default-导出方式"><a href="#export-和-export-default-导出方式" class="header-anchor">#</a> export 和 export default 导出方式</h4> <p>可以用于导出 常量、函数、文件和模块等。</p> <p>一个文件和模块中，<code>export</code> 可以多次使用， <code>import</code> 也是。</p> <p>但是 <code>export default</code> 只有一个</p> <ul><li>export 导出的是变量/接口，而不是值。所以模块内修改了变量值，外部引入得到的值会受到影响
<ul><li>导入的时候需要 {var, fn}</li></ul></li> <li>export default 导出的是一个具体的值。若模块内修改了这个导出的变量值，外部引入的值也不会影响
<ul><li>export default 不能直接导出变量表达式，不建议使用</li> <li>同时导出的结果可以随意命名变量，不利于团队管理</li> <li>因为直接导出了整体对象不利于 tree shaking 分析模块</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// 1 单个导出 a（注意不是导出 1）</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span>

<span class="token comment">// 2 导出变量，注意不能写成 a:1 这样的形式</span>
<span class="token comment">// 这里导出的不是对象，而是一个变量列表，注意这是固定写法</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
	a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c
<span class="token punctuation">}</span>

<span class="token comment">// 3 默认导出，直接导出某个变量，外层引入时可以直接获取到</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>d<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>

<span class="token comment">// 4 还可以把某个对象取别名为 default</span>
<span class="token comment">// 等价于 export default obj</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
	obj <span class="token keyword">as</span> <span class="token keyword">default</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="导出操作"><a href="#导出操作" class="header-anchor">#</a> 导出操作</h4> <ul><li><p>注意导出的接口映射， 即用 {} 包裹变量</p></li> <li><p>export 可以在顶层作用域的任何位置出现，但是不能在块级作用域中（违背模块化思想）</p></li> <li><p>export.default 导出的是整个模块， export 导出的是可选择的变量对象</p></li> <li><ul><li>实际是导出了 default 的变量或方法，所以可以导入时可以任意改名</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1 module.js export </span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">// 导出变量</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">dogSay</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token comment">// 导出方法</span>
<span class="token comment">// 一起导出</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">,</span> 
    dogSay <span class="token keyword">as</span> newName <span class="token comment">// 可以更改导出名字,原名仍然可以使用</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2 export.default</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">export</span> m<span class="token punctuation">;</span><span class="token comment">// 会报错。因为导出的是100，而非接口。要像上面一样 {m} 建立关系</span>
<span class="token keyword">export</span><span class="token punctuation">.</span>default <span class="token operator">=</span> m<span class="token punctuation">;</span> <span class="token comment">// 或这样这样写也是可以的，但是导出的就只有一个 m 引用了</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>m <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 与上一句等效。因为本质就是导出了 default 引用</span>
</code></pre></div><h4 id="导入操作"><a href="#导入操作" class="header-anchor">#</a> 导入操作</h4> <p>注意这里的 {dogSay}不是解构语法，而是具名导入。名字必须和模块中导出的一样</p> <ul><li>引入的模块变量是模块内部对应变量的引用，修改会直接改变原模块中的值</li> <li>不可以更改导入的接口值（如原模块中的m=1这种），但是可以更改引用对象的属性值</li> <li>from 的文件路径，绝对和相对都可以。</li> <li><ul><li>可以省略 .js 后缀</li> <li>若只有模块名，而非路径。则必须有配置文件，来配置该模块的位置</li></ul></li> <li>import 会变量提升，会把声明放文件顶部，提升到整个模块头部，首先执行</li> <li>import 静态执行，所以不能用动态的表达式和变量</li> <li>import 是静态语法，所以只能在 JS 文件的顶部环境，不能放到作用域下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// user.js 引入的问题</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>dogSay<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../module.js'</span> <span class="token comment">// 导入的是 export </span>
<span class="token keyword">import</span> m <span class="token keyword">from</span> <span class="token string">'../module.js'</span> <span class="token comment">// 导入的是 export.default，导入的名字可任意</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token string">'f'</span><span class="token operator">+</span><span class="token string">'2'</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../module.js'</span> <span class="token comment">// 报错，不能写动态表达式</span>
<span class="token keyword">import</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span> <span class="token comment">// 直接加载模块，且只执行一次</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> circle <span class="token keyword">from</span> <span class="token string">'./circle'</span><span class="token punctuation">;</span> <span class="token comment">// 加载全部 export 导出的，且改名</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>circle<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 相当于转发操作，在本模块中将引入的模块直接抛了</span>

<span class="token comment">// 全部导入，还要解构 default 对象</span>
<span class="token comment">// default 是关键词所以不能直接解构，所以要取别名</span>
<span class="token comment">// obj1 和 obj2 的两种方式拿到的都是 default</span>
<span class="token keyword">import</span> obj1<span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token keyword">default</span> <span class="token keyword">as</span> obj2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a.js'</span>

<span class="token comment">// 使用上的问题</span>
m <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 1 无法修改，是只读的</span>
dogSay<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 2 引用类型可以修改</span>
</code></pre></div><h4 id="常量的跨模块应用"><a href="#常量的跨模块应用" class="header-anchor">#</a> 常量的跨模块应用</h4> <p>若有很多常量，则需要新建一个目录专门存放，然后分文件导出。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// constants/db.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">'http://my.couchdbserver.local:5984'</span><span class="token punctuation">,</span>
  admin_username<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
  admin_password<span class="token operator">:</span> <span class="token string">'admin password'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// constants/user.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'staff'</span><span class="token punctuation">,</span> <span class="token string">'ceo'</span><span class="token punctuation">,</span> <span class="token string">'chief'</span><span class="token punctuation">,</span> <span class="token string">'moderator'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>最后由一个 index.js 来统一整合再导出,</p> <blockquote><p>把其他模块导入，然后统一导出，这样外部就可以只引入这个代理模块就行</p></blockquote> <ul><li>export from 导入立即导出</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// constants/index.js</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>db<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./db'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>users<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./x'</span> <span class="token comment">// 把 x 模块中的所有内容统一导出</span>
</code></pre></div><p>使用的时候，只需要导入一个模块就行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// script.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>db<span class="token punctuation">,</span> users<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants/index'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="动态导入模块新-api-——-import"><a href="#动态导入模块新-api-——-import" class="header-anchor">#</a> 动态导入模块新 API —— import()</h4> <p>可以像调用函数一样动态导入模块，返回一个 promise。</p> <ul><li>import() 动态导入，返回 promise</li></ul> <h5 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h5> <blockquote><p>动态导入，还是一个草案
要安装一个 babel 插件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 可以动态导入</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./section-modules/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>someVariable<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span><span class="token function">loadPageInto</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  main<span class="token punctuation">.</span>textContent <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h5> <ul><li>按需加载。需要的时候再去执行</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./dialogBox.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">{</span>exp1<span class="token punctuation">,</span> exp2<span class="token punctuation">}</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 加载后作为对象，成为 then 的参数。所以可解构可具名</span>
    dialogBox<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Error handling */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>条件加载。根据场景分支加载不同的模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'moduleA'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'moduleB'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>动态的模块路径</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 根据 fn() 返回值来加载</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>并发加载多模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module1.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module2.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module3.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>module1<span class="token punctuation">,</span> module2<span class="token punctuation">,</span> module3<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   ···
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>配合 async/await</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./myModule.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>export1<span class="token punctuation">,</span> export2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./myModule.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>module1<span class="token punctuation">,</span> module2<span class="token punctuation">,</span> module3<span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module1.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module2.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module3.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在浏览器中使用-es-模块化"><a href="#在浏览器中使用-es-模块化" class="header-anchor">#</a> 在浏览器中使用 ES 模块化</h3> <h4 id="浏览器加载-script-标签"><a href="#浏览器加载-script-标签" class="header-anchor">#</a> 浏览器加载 script 标签</h4> <h5 id="传统模式"><a href="#传统模式" class="header-anchor">#</a> 传统模式</h5> <p>默认的 script 标签 type=application/javascript，也就是加载 JS 脚本。因为是默认是的，所以可以忽略不写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;application/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>这样加载的 JS 脚本有一个阻塞浏览器渲染的因素，所以浏览器提供了异步的加载方式（注意代码不要和DOM有强关联）</p> <ul><li>defer。渲染完毕后再执行，且多个 defer 脚本会按页面顺序加载</li> <li>async。一旦下载完毕，渲染引擎就终端渲染，来执行该脚本</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span> defer<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span> async<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h5 id="模块加载规则"><a href="#模块加载规则" class="header-anchor">#</a> 模块加载规则</h5> <p>1 在 <code>script</code> 标签中增加 <code>type=&quot;module&quot;</code> ，浏览器会知道这个文件是模块化的方式来运行的。</p> <p>2 都是异步的，不会造成浏览器阻塞，模式默认是 <code>defer</code>。当然也可以开启 <code>async</code> 模式</p> <p>3 若有多个 <code>module</code>，会按照页面顺序执行加载</p> <p>4 模块内部顶层作用域中的 <code>this</code> 是 <code>undefined</code>，所以直接在顶部使用 <code>this</code> 是无意义的</p> <ul><li>利用这个特性，可以检测当前代码是否在 ES6 模块中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> isNotModuleScript <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>对于这个 <code>module</code> 还可以应用于当前浏览器的兼容性，因为支持 <code>ES</code> 模块，那肯定支持其他 <code>ES NEXT</code> 特性</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module1'</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li>在不支持的浏览器，<code>script</code> 标签要用 <code>nomodule</code> 属性来指定某脚本为 <code>fallback</code> 方案</li></ul> <blockquote><p>这是一种优雅降级</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module1'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nomodule</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
     <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'你的浏览器不支持 ES 模块，请先升级！'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="node-中的模块"><a href="#node-中的模块" class="header-anchor">#</a> Node 中的模块</h2> <p>NodeJS 的模块遵循 CommonJS 规范。简单说就是：</p> <ul><li><p>module：模块标识</p></li> <li><p>exports：模块定义</p></li> <li><p>require：模块引用</p></li></ul> <p>在 node9 开始，也开始支持 ESM 规范。但是在执行脚本时需要加上 <code>--experimental-modules</code>。或者使用 <code>babel-cli/babel-preset-env</code> 来处理。</p> <h3 id="export-和-module-对象"><a href="#export-和-module-对象" class="header-anchor">#</a> export 和 module 对象</h3> <p>当Node执行一个文件时，该文件内会自动生成2个对象</p> <ul><li><p>module 对象</p></li> <li><p>该对象中还有一个 exports属性，就是我们认识的 module.exports</p></li> <li><p>exports 对象</p></li></ul> <p>理解他们2个的区别，就需要从内存着手。</p> <blockquote><p>被Node执行的文件，存在一个内存。</p> <p>首先，module.exports 指向了该内存。</p> <p>然后，exports 也跟着指向该内存。</p> <p>最后暴露给外面的，仅仅是 module.exports， 而 exports 暴露的无关紧要（只是用来干活的）。</p> <p>我们导入的都是 module.exports 指向的内存的东西</p></blockquote> <p><img src="https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200119143259.png" alt=""></p> <h3 id="导入和导出"><a href="#导入和导出" class="header-anchor">#</a> 导入和导出</h3> <p>当然我们可以改变 exports 的指向，但是我们导入的时候能找到的只有 module.exports 内存中的数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// module.js</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">123</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">200</span> 
<span class="token comment">// 相当于下面的操纵</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token number">200</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 改变了 exports 自己的引用指向</span>

<span class="token comment">// user.js</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../module.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// {a:200}</span>
</code></pre></div><p>如果返回的是一个类或者构造函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// module.js</span>
<span class="token keyword">class</span> <span class="token class-name">XXX</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">XXX</span>

<span class="token comment">// user.js</span>
<span class="token keyword">const</span> <span class="token constant">XXX</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../module.js'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> xxxx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XXX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="script-模块"><a href="#script-模块" class="header-anchor">#</a> Script 模块</h2> <h3 id="script-标签引入的方式"><a href="#script-标签引入的方式" class="header-anchor">#</a> script 标签引入的方式</h3> <p>针对 <code>&lt;script&gt;</code> 脚本的异步加载，使用 “defer 或 async”。来提高页面的性能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;/script1.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script defer type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;/script2.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script <span class="token keyword">async</span> type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;/script3.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="画几张图简要说明"><a href="#画几张图简要说明" class="header-anchor">#</a> 画几张图简要说明</h3> <blockquote><p>网上有了不少这种类似的图，但是基本都是拿一个script就举例的</p> <p>未免太过寒酸，so咱们来一个豪华版，来画一下多个脚本加载时的甘特图</p> <p>就像近年来各大手机厂商，出新机都喜欢来一个X+X plus</p></blockquote> <p>拿四个不同的颜色来标明各自代表的含义，</p> <blockquote><p>更正：文档渲染 应该为 文档解析</p></blockquote> <p><img src="https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200119143448.png" alt=""></p> <h4 id="普通-script"><a href="#普通-script" class="header-anchor">#</a> 普通 script</h4> <p>文档解析的过程中，如果遇到script脚本，就会停止页面的解析进行下载（但是Chrome会做一个优化，如果遇到script脚本，会快速的查看后边有没有需要下载其他资源的，如果有的话，会先下载那些资源，然后再进行下载script所对应的资源，这样能够节省一部分下载的时间）。</p> <p>资源的下载是在解析过程中进行的，虽说script1脚本会很快的加载完毕，但是他前边的script2并没有加载&amp;执行，所以他只能处于一个挂起的状态，等待script2执行完毕后再执行。</p> <p>当这两个脚本都执行完毕后，才会继续解析页面。</p> <p><img src="https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200119143516.png" alt=""></p> <h4 id="defer"><a href="#defer" class="header-anchor">#</a> defer</h4> <p>文档解析时，遇到设置了<code>defer</code> 的脚本，就会在后台进行下载，但是并不会阻止文档的渲染，当页面解析&amp;渲染完毕后。</p> <p>会等到所有的 <code>defer</code> 脚本加载完毕并按照顺序执行，执行完毕后会触发 <code>DOMContentLoaded</code> 事件。</p> <p><img src="https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200119143538.png" alt=""></p> <h4 id="async"><a href="#async" class="header-anchor">#</a> async</h4> <p>async 脚本会在加载完毕后执行。</p> <p>async 脚本的加载不计入 <code>DOMContentLoaded</code> 事件统计，也就是说下图两种情况都是有可能发生的</p> <p><img src="https://raw.githubusercontent.com/ErrorJe/ErrorJE.github.io/images/img/20200119143609.png" alt=""></p> <h3 id="推荐的应用场景"><a href="#推荐的应用场景" class="header-anchor">#</a> 推荐的应用场景</h3> <h4 id="defer-2"><a href="#defer-2" class="header-anchor">#</a> defer</h4> <p>如果你的脚本代码依赖于页面中的DOM元素（文档是否解析完毕），或者被其他脚本文件依赖。</p> <div class="language-hs extra-class"><pre class="language-hs"><code>评论框
代码语法高亮
<span class="token hvariable">polyfill</span><span class="token punctuation">.</span><span class="token hvariable">js</span>
</code></pre></div><h4 id="async-2"><a href="#async-2" class="header-anchor">#</a> async</h4> <p>如果你的脚本并不关心页面中的DOM元素（文档是否解析完毕），并且也不会产生其他脚本需要的数据。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 百度统计</span>

如果不太能确定的话，用defer总是会比<span class="token keyword">async</span>稳定。。。
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">1/19/2020, 7:19:36 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/whole-stack-note/assets/js/app.ea1ba87a.js" defer></script><script src="/whole-stack-note/assets/js/2.6d170185.js" defer></script><script src="/whole-stack-note/assets/js/17.7a625432.js" defer></script>
  </body>
</html>
